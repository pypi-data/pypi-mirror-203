import{s as q}from"./vue-virtual-scroller.esm-4b592697.js";/* empty css                             */import{d as A,b as H,G as W,r as u,c as k,z as I,y as J,A as O,o as m,n as g,a as i,j as V,w as n,F as P,v as T,f as b,l as _,h as v,q as $,m as Q,s as L,k as R,i as X,W as Y}from"./index-509cb659.js";import{_ as Z}from"./ListviewItem.vue_vue_type_style_index_0_lang-a3ebfe31.js";import{_ as z,a as ee}from"./MediaItemContextMenu.vue_vue_type_style_index_0_lang-032d9148.js";import{V as te,a as ae,b as le}from"./VSelect-10ebac75.js";import{V as se,a as re}from"./VRow-eaa44edd.js";import{V as oe}from"./VSpacer-8a065407.js";import{V as ie}from"./VTooltip-7c1a01df.js";import{V as ue,l as ne}from"./VBtn-ed6bb85a.js";import{V as me}from"./VToolbar-1f8773ff.js";import"./utils-07cca6a9.js";import"./VCardText-4d75afb5.js";import"./_plugin-vue_export-helper-36d545f5.js";import"./ProviderIcon.vue_vue_type_script_setup_true_lang-24923313.js";import"./VCard-9bf7150f.js";import"./forwardRefs-07c66854.js";import"./VDivider-3f2d2e44.js";import"./VMenu-c622518f.js";import"./VLabel-ac476141.js";import"./VCheckboxBtn-d3a440a9.js";import"./VDialog-57ad130c.js";/* empty css              */const ve={style:{"margin-left":"15px","margin-right":"15px","margin-top":"20px","margin-bottom":"20px",padding:"0"}},fe={key:2},pe={style:{"margin-left":"15px"}},Ue=A({__name:"Search",props:{initSearch:null},setup(N){const C=N,U=H(),{mobile:D}=W(),s=u("list"),y=u(0),r=u(""),f=u(!1),l=u(),w=u(!1),p=u(!1),c=u([]),x=u(),M=["topresult","artists","albums","tracks","playlists"],E=k(()=>D.value?140:150),G=function(){s.value==="panel"?s.value="list":s.value="panel",localStorage.setItem(`viewMode.search.${o.value}`,s.value)},B=function(e){c.value=[e],p.value=!0},F=function(e){var t;["artist","album","playlist"].includes(e.media_type)||!((t=L.selectedPlayer)!=null&&t.available)?U.push({name:e.media_type,params:{itemId:e.item_id,provider:e.provider}}):L.selectedPlayer&&R.playMedia(e)};I(()=>r.value,()=>{clearTimeout(x.value),x.value=setTimeout(()=>{j()},200)});const K=function(e){return e<500?2:e<=500?3:e<=700?4:e<=1e3?5:e<=1200?6:e<=1500?7:e<=1700?8:e>1700?9:0},j=async function(){w.value=!0,localStorage.setItem("globalsearch",r.value),r.value?l.value=await R.search(r.value):l.value=void 0,w.value=!1},o=k(()=>M[y.value]),d=k(()=>{if(!l.value)return[];if(o.value=="artists")return l.value.artists;if(o.value=="albums")return l.value.albums;if(o.value=="tracks")return l.value.tracks;if(o.value=="playlists")return l.value.playlists;if(o.value=="radios")return l.value.radio;if(o.value=="topresult"){const e=[];for(const t of[l.value.tracks,l.value.artists,l.value.albums,l.value.playlists,l.value.radio]){const a=[];for(const h of t)a.includes(h.provider)||(e.push(h),a.push(h.provider))}return e}return[]});I(()=>o.value,e=>{if(e){const t=localStorage.getItem(`viewMode.search.${o.value}`);t?s.value=t:o.value=="artists"||o.value=="albums"?s.value="panel":s.value="list"}},{immediate:!0}),J(()=>{if(C.initSearch)r.value=C.initSearch;else{const e=localStorage.getItem("globalsearch");e&&e!=="null"&&(r.value=e)}});const S=function(e){p.value||(e.key==="a"&&(e.ctrlKey||e.metaKey)?(e.preventDefault(),c.value=d.value):!f.value&&e.key=="Backspace"?r.value=r.value.slice(0,-1):!f.value&&e.key.length==1&&(r.value+=e.key))};return document.addEventListener("keydown",S),O(()=>{document.removeEventListener("keydown",S)}),(e,t)=>(m(),g("div",null,[i(te,{id:"searchInput",modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=a=>r.value=a),clearable:"","prepend-inner-icon":"mdi-magnify",label:e.$t("type_to_search"),"hide-details":"",variant:"filled",onFocus:t[1]||(t[1]=a=>f.value=!0),onBlur:t[2]||(t[2]=a=>f.value=!1)},null,8,["modelValue","label"]),V("div",null,[i(ae,{modelValue:y.value,"onUpdate:modelValue":t[3]||(t[3]=a=>y.value=a),column:"",style:{"margin-top":"15px","margin-left":"10px"}},{default:n(()=>[(m(),g(P,null,T(M,a=>i(le,{key:a,filter:"",outlined:""},{default:n(()=>[X($(e.$t(a)),1)]),_:2},1024)),64))]),_:1},8,["modelValue"]),i(z,{modelValue:p.value,"onUpdate:modelValue":t[4]||(t[4]=a=>p.value=a),items:c.value,onClear:t[5]||(t[5]=()=>{c.value=[]})},null,8,["modelValue","items"]),V("div",ve,[w.value?(m(),b(ne,{key:0,indeterminate:""})):_("",!0),s.value=="panel"?(m(),b(se,{key:1},{default:n(()=>[(m(!0),g(P,null,T(v(d),a=>(m(),b(re,{key:a.uri,class:Y(`col-${K(e.$vuetify.display.width)}`)},{default:n(()=>[i(ee,{item:a,size:v(E),"is-selected":!1,"show-checkboxes":!1,onMenu:B,onClick:F},null,8,["item","size"])]),_:2},1032,["class"]))),128))]),_:1})):_("",!0),s.value=="list"?(m(),g("div",fe,[i(v(q),{items:v(d),"item-size":60,"key-field":"item_id","page-mode":""},{default:n(({item:a})=>[i(Z,{item:a,"show-track-number":!1,"show-duration":!0,"show-library":!1,"show-menu":!0,"show-providers":!0,"show-checkboxes":!1,"is-selected":!1,"show-details":!0,onMenu:B,onClick:F},null,8,["item"])]),_:1},8,["items"])])):_("",!0)]),i(me,{density:"compact",variant:"flat",color:"transparent",height:"45"},{default:n(()=>[V("span",pe,$(e.$t("items_total",[v(d).length])),1),i(oe),i(ie,{location:"bottom"},{activator:n(({props:a})=>[i(ue,Q(a,{icon:s.value=="panel"?"mdi-view-list":"mdi-grid",variant:"plain",onClick:t[6]||(t[6]=h=>G())}),null,16,["icon"])]),default:n(()=>[V("span",null,$(e.$t("tooltip.toggle_view_mode")),1)]),_:1})]),_:1})])]))}});export{Ue as default};
