{"version":3,"file":"chunks/app_views_settings_project_projectTeams_tsx.xxxxxxxxxxxxxxxxxxxx.js","mappings":"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","sources":["webpack:///./app/utils/routeTitle.tsx","webpack:///./app/views/settings/project/projectTeams.tsx"],"sourcesContent":["function routeTitleGen(\n  routeName: string,\n  orgSlug: string,\n  withSentry: boolean = true,\n  projectSlug?: string\n): string {\n  const tmplBase = `${routeName} - ${orgSlug}`;\n  const tmpl = projectSlug ? `${tmplBase} - ${projectSlug}` : tmplBase;\n\n  return withSentry ? `${tmpl} - Sentry` : tmpl;\n}\n\nexport default routeTitleGen;\n","import {RouteComponentProps} from 'react-router';\nimport {css} from '@emotion/react';\nimport styled from '@emotion/styled';\n\nimport {addErrorMessage} from 'sentry/actionCreators/indicator';\nimport {openCreateTeamModal} from 'sentry/actionCreators/modal';\nimport {addTeamToProject, removeTeamFromProject} from 'sentry/actionCreators/projects';\nimport Link from 'sentry/components/links/link';\nimport {Tooltip} from 'sentry/components/tooltip';\nimport {t, tct} from 'sentry/locale';\nimport TeamStore from 'sentry/stores/teamStore';\nimport {space} from 'sentry/styles/space';\nimport {Organization, Project, Team} from 'sentry/types';\nimport routeTitleGen from 'sentry/utils/routeTitle';\nimport AsyncView from 'sentry/views/asyncView';\nimport SettingsPageHeader from 'sentry/views/settings/components/settingsPageHeader';\nimport TeamSelect from 'sentry/views/settings/components/teamSelect';\n\ntype Props = {\n  organization: Organization;\n  project: Project;\n} & RouteComponentProps<{projectId: string}, {}>;\n\ntype State = {\n  projectTeams: null | Team[];\n} & AsyncView['state'];\n\nclass ProjectTeams extends AsyncView<Props, State> {\n  getEndpoints(): ReturnType<AsyncView['getEndpoints']> {\n    const {organization, project} = this.props;\n    return [['projectTeams', `/projects/${organization.slug}/${project.slug}/teams/`]];\n  }\n\n  getTitle() {\n    const {projectId} = this.props.params;\n    return routeTitleGen(t('Project Teams'), projectId, false);\n  }\n\n  canCreateTeam = () => {\n    const access = this.props.organization.access;\n    return (\n      access.includes('org:write') &&\n      access.includes('team:write') &&\n      access.includes('project:write')\n    );\n  };\n\n  handleRemove = (teamSlug: Team['slug']) => {\n    if (this.state.loading) {\n      return;\n    }\n\n    const {organization, project} = this.props;\n\n    removeTeamFromProject(this.api, organization.slug, project.slug, teamSlug)\n      .then(() => this.handleRemovedTeam(teamSlug))\n      .catch(() => {\n        addErrorMessage(t('Could not remove the %s team', teamSlug));\n        this.setState({loading: false});\n      });\n  };\n\n  handleRemovedTeam = (teamSlug: Team['slug']) => {\n    this.setState(prevState => ({\n      projectTeams: [\n        ...(prevState.projectTeams || []).filter(team => team.slug !== teamSlug),\n      ],\n    }));\n  };\n\n  handleAddedTeam = (team: Team) => {\n    this.setState(prevState => ({\n      projectTeams: [...(prevState.projectTeams || []), team],\n    }));\n  };\n\n  handleAdd = (teamSlug: string) => {\n    if (this.state.loading) {\n      return;\n    }\n\n    const team = TeamStore.getBySlug(teamSlug);\n    if (!team) {\n      addErrorMessage(tct('Unable to find \"[teamSlug]\"', {teamSlug}));\n      this.setState({error: true});\n      return;\n    }\n\n    const {organization, project} = this.props;\n\n    addTeamToProject(this.api, organization.slug, project.slug, team).then(\n      () => {\n        this.handleAddedTeam(team);\n      },\n      () => {\n        this.setState({\n          error: true,\n          loading: false,\n        });\n      }\n    );\n  };\n\n  handleCreateTeam = (e: React.MouseEvent) => {\n    e.stopPropagation();\n    e.preventDefault();\n\n    const {project, organization} = this.props;\n\n    if (!this.canCreateTeam()) {\n      return;\n    }\n\n    openCreateTeamModal({\n      project,\n      organization,\n      onClose: data => {\n        addTeamToProject(this.api, organization.slug, project.slug, data).then(\n          this.remountComponent,\n          this.remountComponent\n        );\n      },\n    });\n  };\n\n  renderBody() {\n    const {project, organization} = this.props;\n\n    const canCreateTeam = this.canCreateTeam();\n    const hasAccess = organization.access.includes('project:write');\n    const confirmRemove = t(\n      'This is the last team with access to this project. Removing it will mean only organization owners and managers will be able to access the project pages. Are you sure you want to remove this team from the project %s?',\n      project.slug\n    );\n    const {projectTeams} = this.state;\n\n    const menuHeader = (\n      <StyledTeamsLabel>\n        {t('Teams')}\n        <Tooltip\n          disabled={canCreateTeam}\n          title={t('You must be a project admin to create teams')}\n          position=\"top\"\n        >\n          <StyledCreateTeamLink\n            to=\"#create-team\"\n            disabled={!canCreateTeam}\n            onClick={this.handleCreateTeam}\n          >\n            {t('Create Team')}\n          </StyledCreateTeamLink>\n        </Tooltip>\n      </StyledTeamsLabel>\n    );\n\n    return (\n      <div>\n        <SettingsPageHeader title={t('Project Teams for %s', project.slug)} />\n        <TeamSelect\n          disabled={!hasAccess}\n          enforceIdpProvisioned={false}\n          organization={organization}\n          menuHeader={menuHeader}\n          selectedTeams={projectTeams ?? []}\n          onAddTeam={this.handleAdd}\n          onRemoveTeam={this.handleRemove}\n          confirmLastTeamRemoveMessage={confirmRemove}\n        />\n      </div>\n    );\n  }\n}\n\nconst StyledTeamsLabel = styled('div')`\n  font-size: 0.875em;\n  padding: ${space(0.5)} 0px;\n  text-transform: uppercase;\n`;\n\nconst StyledCreateTeamLink = styled(Link)`\n  float: right;\n  text-transform: none;\n  ${p =>\n    p.disabled &&\n    css`\n      cursor: not-allowed;\n      color: ${p.theme.gray300};\n      opacity: 0.6;\n    `};\n`;\n\nexport default ProjectTeams;\n"],"names":["routeName","orgSlug","projectSlug","arguments","length","undefined","tmplBase","tmpl","ProjectTeams","AsyncView","constructor","_defineProperty","access","this","props","organization","includes","teamSlug","state","loading","project","removeTeamFromProject","api","slug","then","handleRemovedTeam","catch","addErrorMessage","t","setState","prevState","projectTeams","filter","team","TeamStore","tct","error","addTeamToProject","handleAddedTeam","e","stopPropagation","preventDefault","canCreateTeam","openCreateTeamModal","onClose","data","remountComponent","getEndpoints","getTitle","projectId","params","routeTitleGen","renderBody","hasAccess","confirmRemove","menuHeader","_jsxs","StyledTeamsLabel","children","_jsx","Tooltip","disabled","title","position","StyledCreateTeamLink","to","onClick","handleCreateTeam","SettingsPageHeader","TeamSelect","enforceIdpProvisioned","selectedTeams","onAddTeam","handleAdd","onRemoveTeam","handleRemove","confirmLastTeamRemoveMessage","_styled","target","space","Link","p","css","theme","gray300"],"sourceRoot":""}