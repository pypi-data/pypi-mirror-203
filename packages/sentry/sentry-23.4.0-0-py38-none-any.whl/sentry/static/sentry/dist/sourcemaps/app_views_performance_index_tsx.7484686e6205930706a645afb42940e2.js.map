{"version":3,"file":"chunks/app_views_performance_index_tsx.xxxxxxxxxxxxxxxxxxxx.js","mappings":"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","sources":["webpack:///./app/utils/discover/genericDiscoverQuery.tsx","webpack:///./app/utils/performance/metricsEnhanced/metricsCompatibilityQuery.tsx","webpack:///./app/utils/performance/metricsEnhanced/metricsCompatibilityQuerySums.tsx","webpack:///./app/utils/performance/contexts/metricsCardinality.tsx","webpack:///./app/utils/performance/contexts/metricsEnhancedSetting.tsx","webpack:///./app/utils/performance/contexts/performanceEventViewContext.tsx","webpack:///./app/utils/performance/contexts/utils.tsx","webpack:///./app/views/performance/index.tsx"],"sourcesContent":["import {Component, useContext} from 'react';\nimport {useQuery} from '@tanstack/react-query';\nimport {Location} from 'history';\n\nimport {EventQuery} from 'sentry/actionCreators/events';\nimport {Client, ResponseMeta} from 'sentry/api';\nimport {t} from 'sentry/locale';\nimport EventView, {\n  ImmutableEventView,\n  isAPIPayloadSimilar,\n  LocationQuery,\n} from 'sentry/utils/discover/eventView';\nimport {QueryBatching} from 'sentry/utils/performance/contexts/genericQueryBatcher';\nimport {PerformanceEventViewContext} from 'sentry/utils/performance/contexts/performanceEventViewContext';\nimport {OrganizationContext} from 'sentry/views/organizationContext';\n\nimport useApi from '../useApi';\n\nexport class QueryError {\n  message: string;\n  private originalError: any; // For debugging in case parseError picks a value that doesn't make sense.\n  constructor(errorMessage: string, originalError?: any) {\n    this.message = errorMessage;\n    this.originalError = originalError;\n  }\n\n  getOriginalError() {\n    return this.originalError;\n  }\n}\n\nexport type GenericChildrenProps<T> = {\n  /**\n   * Error, if not null.\n   */\n  error: null | QueryError;\n  /**\n   * Loading state of this query.\n   */\n  isLoading: boolean;\n  /**\n   * Pagelinks, if applicable. Can be provided to the Pagination component.\n   */\n  pageLinks: null | string;\n  /**\n   * Data / result.\n   */\n  tableData: T | null;\n};\n\ntype OptionalContextProps = {\n  eventView?: EventView | ImmutableEventView;\n  orgSlug?: string;\n};\n\ntype BaseDiscoverQueryProps = {\n  /**\n   * Used as the default source for cursor values.\n   */\n  location: Location;\n  /**\n   * Explicit cursor value if you aren't using `location.query.cursor` because there are\n   * multiple paginated results on the page.\n   */\n  cursor?: string;\n  /**\n   * Appends a raw string to query to be able to sidestep the tokenizer.\n   * @deprecated\n   */\n  forceAppendRawQueryString?: string;\n  /**\n   * Record limit to get.\n   */\n  limit?: number;\n  /**\n   * Include this whenever pagination won't be used. Limit can still be used when this is\n   * passed, but cursor will be ignored.\n   */\n  noPagination?: boolean;\n  /**\n   * A container for query batching data and functions.\n   */\n  queryBatching?: QueryBatching;\n  /**\n   * Extra query parameters to be added.\n   */\n  queryExtras?: Record<string, string>;\n  /**\n   * Sets referrer parameter in the API Payload. Set of allowed referrers are defined\n   * on the OrganizationDiscoverEndpoint view.\n   */\n  referrer?: string;\n  /**\n   * A callback to set an error so that the error can be rendered in parent components\n   */\n  setError?: (errObject: QueryError | undefined) => void;\n};\n\nexport type DiscoverQueryPropsWithContext = BaseDiscoverQueryProps & OptionalContextProps;\nexport type DiscoverQueryProps = BaseDiscoverQueryProps & {\n  eventView: EventView | ImmutableEventView;\n  orgSlug: string;\n};\n\ntype InnerRequestProps<P> = DiscoverQueryProps & P;\ntype OuterRequestProps<P> = DiscoverQueryPropsWithContext & P;\n\nexport type ReactProps<T> = {\n  children?: (props: GenericChildrenProps<T>) => React.ReactNode;\n};\n\ntype ComponentProps<T, P> = {\n  /**\n   * Route to the endpoint\n   */\n  route: string;\n  /**\n   * A hook to modify data into the correct output after data has been received\n   */\n  afterFetch?: (data: any, props?: Props<T, P>) => T;\n  /**\n   * A hook before fetch that can be used to do things like clearing the api\n   */\n  beforeFetch?: (api: Client) => void;\n  /**\n   * A hook for parent orchestrators to pass down data based on query results, unlike afterFetch it is not meant for specializations as it will not modify data.\n   */\n  didFetch?: (data: T) => void;\n  /**\n   * Allows components to modify the payload before it is set.\n   */\n  getRequestPayload?: (props: Props<T, P>) => any;\n  /**\n   * An external hook to parse errors in case there are differences for a specific api.\n   */\n  parseError?: (error: any) => QueryError | null;\n  /**\n   * An external hook in addition to the event view check to check if data should be refetched\n   */\n  shouldRefetchData?: (prevProps: Props<T, P>, props: Props<T, P>) => boolean;\n};\n\ntype Props<T, P> = InnerRequestProps<P> & ReactProps<T> & ComponentProps<T, P>;\ntype OuterProps<T, P> = OuterRequestProps<P> & ReactProps<T> & ComponentProps<T, P>;\n\ntype State<T> = {\n  api: Client;\n  tableFetchID: symbol | undefined;\n} & GenericChildrenProps<T>;\n\n/**\n * Generic component for discover queries\n */\nclass _GenericDiscoverQuery<T, P> extends Component<Props<T, P>, State<T>> {\n  state: State<T> = {\n    isLoading: true,\n    tableFetchID: undefined,\n    error: null,\n\n    tableData: null,\n    pageLinks: null,\n    api: new Client(),\n  };\n\n  componentDidMount() {\n    this.fetchData();\n  }\n\n  componentDidUpdate(prevProps: Props<T, P>) {\n    // Reload data if the payload changes\n    const refetchCondition = this._shouldRefetchData(prevProps);\n\n    // or if we've moved from an invalid view state to a valid one,\n    const eventViewValidation =\n      prevProps.eventView.isValid() === false && this.props.eventView.isValid();\n\n    const shouldRefetchExternal = this.props.shouldRefetchData\n      ? this.props.shouldRefetchData(prevProps, this.props)\n      : false;\n\n    if (refetchCondition || eventViewValidation || shouldRefetchExternal) {\n      this.fetchData();\n    }\n  }\n\n  _shouldRefetchData = (prevProps: Props<T, P>): boolean => {\n    const thisAPIPayload = getPayload(this.props);\n    const otherAPIPayload = getPayload(prevProps);\n\n    return (\n      !isAPIPayloadSimilar(thisAPIPayload, otherAPIPayload) ||\n      prevProps.limit !== this.props.limit ||\n      prevProps.route !== this.props.route ||\n      prevProps.cursor !== this.props.cursor\n    );\n  };\n\n  /**\n   * The error type isn't consistent across APIs. We see detail as just string some times, other times as an object.\n   */\n  _parseError = (error: any): QueryError | null => {\n    if (this.props.parseError) {\n      return this.props.parseError(error);\n    }\n\n    if (!error) {\n      return null;\n    }\n\n    const detail = error.responseJSON?.detail;\n    if (typeof detail === 'string') {\n      return new QueryError(detail, error);\n    }\n\n    const message = detail?.message;\n    if (typeof message === 'string') {\n      return new QueryError(message, error);\n    }\n\n    const unknownError = new QueryError(t('An unknown error occurred.'), error);\n    return unknownError;\n  };\n\n  fetchData = async () => {\n    const {\n      queryBatching,\n      beforeFetch,\n      afterFetch,\n      didFetch,\n      eventView,\n      orgSlug,\n      route,\n      setError,\n    } = this.props;\n    const {api} = this.state;\n\n    if (!eventView.isValid()) {\n      return;\n    }\n\n    const url = `/organizations/${orgSlug}/${route}/`;\n    const tableFetchID = Symbol(`tableFetchID`);\n    const apiPayload: Partial<EventQuery & LocationQuery> = getPayload(this.props);\n\n    this.setState({isLoading: true, tableFetchID});\n\n    setError?.(undefined);\n\n    beforeFetch?.(api);\n\n    // clear any inflight requests since they are now stale\n    api.clear();\n\n    try {\n      const [data, , resp] = await doDiscoverQuery<T>(api, url, apiPayload, {\n        queryBatching,\n      });\n\n      if (this.state.tableFetchID !== tableFetchID) {\n        // invariant: a different request was initiated after this request\n        return;\n      }\n\n      const tableData = afterFetch ? afterFetch(data, this.props) : data;\n      didFetch?.(tableData);\n      this.setState(prevState => ({\n        isLoading: false,\n        tableFetchID: undefined,\n        error: null,\n        pageLinks: resp?.getResponseHeader('Link') ?? prevState.pageLinks,\n        tableData,\n      }));\n    } catch (err) {\n      const error = this._parseError(err);\n      this.setState({\n        isLoading: false,\n        tableFetchID: undefined,\n        error,\n        tableData: null,\n      });\n      if (setError) {\n        setError(error ?? undefined);\n      }\n    }\n  };\n\n  render() {\n    const {isLoading, error, tableData, pageLinks} = this.state;\n\n    const childrenProps: GenericChildrenProps<T> = {\n      isLoading,\n      error,\n      tableData,\n      pageLinks,\n    };\n    const children: ReactProps<T>['children'] = this.props.children; // Explicitly setting type due to issues with generics and React's children\n    return children?.(childrenProps);\n  }\n}\n\n// Shim to allow us to use generic discover query or any specialization with or without passing org slug or eventview, which are now contexts.\n// This will help keep tests working and we can remove extra uses of context-provided props and update tests as we go.\nexport function GenericDiscoverQuery<T, P>(props: OuterProps<T, P>) {\n  const organizationSlug = useContext(OrganizationContext)?.slug;\n  const performanceEventView = useContext(PerformanceEventViewContext)?.eventView;\n\n  const orgSlug = props.orgSlug ?? organizationSlug;\n  const eventView = props.eventView ?? performanceEventView;\n\n  if (orgSlug === undefined || eventView === undefined) {\n    throw new Error('GenericDiscoverQuery requires both an orgSlug and eventView');\n  }\n\n  const _props: Props<T, P> = {\n    ...props,\n    orgSlug,\n    eventView,\n  };\n  return <_GenericDiscoverQuery<T, P> {..._props} />;\n}\n\nexport type DiscoverQueryRequestParams = Partial<EventQuery & LocationQuery>;\n\ntype RetryOptions = {\n  statusCodes: number[];\n  tries: number;\n  baseTimeout?: number;\n  timeoutMultiplier?: number;\n};\n\nconst BASE_TIMEOUT = 200;\nconst TIMEOUT_MULTIPLIER = 2;\nconst wait = duration => new Promise(resolve => setTimeout(resolve, duration));\n\nexport async function doDiscoverQuery<T>(\n  api: Client,\n  url: string,\n  params: DiscoverQueryRequestParams,\n  options: {\n    queryBatching?: QueryBatching;\n    retry?: RetryOptions;\n  } = {}\n): Promise<[T, string | undefined, ResponseMeta<T> | undefined]> {\n  const {queryBatching, retry} = options;\n  if (queryBatching?.batchRequest) {\n    return queryBatching.batchRequest(api, url, {\n      query: params,\n      includeAllArgs: true,\n    });\n  }\n\n  const baseTimeout = retry?.baseTimeout ?? BASE_TIMEOUT;\n  const timeoutMultiplier = retry?.timeoutMultiplier ?? TIMEOUT_MULTIPLIER;\n  const statusCodes = retry?.statusCodes ?? [];\n  const maxTries = retry?.tries ?? 1;\n  let tries = 0;\n  let timeout = 0;\n  let error;\n\n  while (tries < maxTries && (!error || statusCodes.includes(error.status))) {\n    if (timeout > 0) {\n      await wait(timeout);\n    }\n    try {\n      tries++;\n      return await api.requestPromise(url, {\n        method: 'GET',\n        includeAllArgs: true,\n        query: {\n          // marking params as any so as to not cause typescript errors\n          ...(params as any),\n        },\n      });\n    } catch (err) {\n      error = err;\n      timeout = baseTimeout * timeoutMultiplier ** (tries - 1);\n    }\n  }\n  throw error;\n}\n\nfunction getPayload<T, P>(props: Props<T, P>) {\n  const {\n    cursor,\n    limit,\n    noPagination,\n    referrer,\n    getRequestPayload,\n    eventView,\n    location,\n    forceAppendRawQueryString,\n  } = props;\n  const payload = getRequestPayload\n    ? getRequestPayload(props)\n    : eventView.getEventsAPIPayload(location, forceAppendRawQueryString);\n\n  if (cursor) {\n    payload.cursor = cursor;\n  }\n  if (limit) {\n    payload.per_page = limit;\n  }\n  if (noPagination) {\n    payload.noPagination = noPagination;\n  }\n  if (referrer) {\n    payload.referrer = referrer;\n  }\n\n  Object.assign(payload, props.queryExtras ?? {});\n\n  return payload;\n}\n\nexport function useGenericDiscoverQuery<T, P>(props: Props<T, P>) {\n  const api = useApi();\n  const {orgSlug, route} = props;\n  const url = `/organizations/${orgSlug}/${route}/`;\n  const apiPayload = getPayload<T, P>(props);\n\n  return useQuery<T, QueryError>([route, apiPayload], async () => {\n    const [resp] = await doDiscoverQuery<T>(api, url, apiPayload, {\n      queryBatching: props.queryBatching,\n    });\n    return resp;\n  });\n}\n\nexport default GenericDiscoverQuery;\n","import omit from 'lodash/omit';\n\nimport EventView from 'sentry/utils/discover/eventView';\nimport GenericDiscoverQuery, {\n  DiscoverQueryProps,\n  GenericChildrenProps,\n} from 'sentry/utils/discover/genericDiscoverQuery';\n\nexport interface MetricsCompatibilityData {\n  compatible_projects?: number[];\n}\n\ntype QueryProps = Omit<DiscoverQueryProps, 'eventView' | 'api'> & {\n  children: (props: GenericChildrenProps<MetricsCompatibilityData>) => React.ReactNode;\n  eventView: EventView;\n};\n\nfunction getRequestPayload({\n  eventView,\n  location,\n}: Pick<DiscoverQueryProps, 'eventView' | 'location'>) {\n  return omit(eventView.getEventsAPIPayload(location), [\n    'field',\n    'sort',\n    'per_page',\n    'query',\n  ]);\n}\n\nexport default function MetricsCompatibilityQuery({children, ...props}: QueryProps) {\n  return (\n    <GenericDiscoverQuery<MetricsCompatibilityData, {}>\n      route=\"metrics-compatibility-sums\"\n      getRequestPayload={getRequestPayload}\n      {...props}\n    >\n      {({tableData, ...rest}) => {\n        return children({\n          tableData,\n          ...rest,\n        });\n      }}\n    </GenericDiscoverQuery>\n  );\n}\n","import omit from 'lodash/omit';\n\nimport EventView from 'sentry/utils/discover/eventView';\nimport GenericDiscoverQuery, {\n  DiscoverQueryProps,\n  GenericChildrenProps,\n} from 'sentry/utils/discover/genericDiscoverQuery';\n\nexport interface MetricsCompatibilitySumData {\n  sum: {\n    metrics?: number;\n    metrics_null?: number;\n    metrics_unparam?: number;\n  };\n}\n\ntype QueryProps = Omit<DiscoverQueryProps, 'eventView' | 'api'> & {\n  children: (props: GenericChildrenProps<MetricsCompatibilitySumData>) => React.ReactNode;\n  eventView: EventView;\n};\n\nfunction getRequestPayload({\n  eventView,\n  location,\n}: Pick<DiscoverQueryProps, 'eventView' | 'location'>) {\n  return omit(eventView.getEventsAPIPayload(location), [\n    'field',\n    'sort',\n    'per_page',\n    'query',\n  ]);\n}\n\nexport default function MetricsCompatibilitySumsQuery({children, ...props}: QueryProps) {\n  return (\n    <GenericDiscoverQuery<MetricsCompatibilitySumData, {}>\n      route=\"metrics-compatibility\"\n      getRequestPayload={getRequestPayload}\n      {...props}\n    >\n      {({tableData, ...rest}) => {\n        return children({\n          tableData,\n          ...rest,\n        });\n      }}\n    </GenericDiscoverQuery>\n  );\n}\n","import {ComponentProps, Fragment, ReactNode, useEffect} from 'react';\nimport {Location} from 'history';\n\nimport {Organization} from 'sentry/types';\nimport trackAdvancedAnalyticsEvent from 'sentry/utils/analytics/trackAdvancedAnalyticsEvent';\nimport {parsePeriodToHours} from 'sentry/utils/dates';\nimport EventView from 'sentry/utils/discover/eventView';\nimport {canUseMetricsData} from 'sentry/utils/performance/contexts/metricsEnhancedSetting';\nimport MetricsCompatibilityQuery, {\n  MetricsCompatibilityData,\n} from 'sentry/utils/performance/metricsEnhanced/metricsCompatibilityQuery';\nimport MetricsCompatibilitySumsQuery, {\n  MetricsCompatibilitySumData,\n} from 'sentry/utils/performance/metricsEnhanced/metricsCompatibilityQuerySums';\n\nimport {createDefinedContext} from './utils';\n\nconst UNPARAM_THRESHOLD = 0.01;\nconst NULL_THRESHOLD = 0.01;\n\nexport interface MetricDataSwitcherOutcome {\n  forceTransactionsOnly: boolean;\n  compatibleProjects?: number[];\n  shouldNotifyUnnamedTransactions?: boolean;\n  shouldWarnIncompatibleSDK?: boolean;\n}\nexport interface MetricsCardinalityContext {\n  isLoading: boolean;\n  outcome?: MetricDataSwitcherOutcome;\n}\n\ntype MergedMetricsData = MetricsCompatibilityData & MetricsCompatibilitySumData;\n\nconst [_Provider, _useContext, _Context] =\n  createDefinedContext<MetricsCardinalityContext>({\n    name: 'MetricsCardinalityContext',\n    strict: false,\n  });\n\n/**\n * This provider determines whether the metrics data is storing performance information correctly before we\n * make dozens of requests on pages such as performance landing and dashboards.\n */\nexport function MetricsCardinalityProvider(props: {\n  children: ReactNode;\n  location: Location;\n  organization: Organization;\n  sendOutcomeAnalytics?: boolean;\n}) {\n  const isUsingMetrics = canUseMetricsData(props.organization);\n\n  if (!isUsingMetrics) {\n    return (\n      <_Provider\n        value={{\n          isLoading: false,\n          outcome: {\n            forceTransactionsOnly: true,\n          },\n        }}\n      >\n        {props.children}\n      </_Provider>\n    );\n  }\n\n  const baseDiscoverProps = {\n    location: props.location,\n    orgSlug: props.organization.slug,\n    cursor: '0:0:0',\n  };\n  const eventView = EventView.fromLocation(props.location);\n  eventView.fields = [{field: 'tpm()'}];\n  const _eventView = adjustEventViewTime(eventView);\n\n  return (\n    <Fragment>\n      <MetricsCompatibilityQuery eventView={_eventView} {...baseDiscoverProps}>\n        {compatabilityResult => (\n          <MetricsCompatibilitySumsQuery eventView={_eventView} {...baseDiscoverProps}>\n            {sumsResult => {\n              const isLoading = compatabilityResult.isLoading || sumsResult.isLoading;\n              const outcome =\n                compatabilityResult.isLoading || sumsResult.isLoading\n                  ? undefined\n                  : getMetricsOutcome(\n                      compatabilityResult.tableData && sumsResult.tableData\n                        ? {\n                            ...compatabilityResult.tableData,\n                            ...sumsResult.tableData,\n                          }\n                        : null,\n                      !!compatabilityResult.error && !!sumsResult.error,\n                      props.organization\n                    );\n\n              return (\n                <Provider\n                  sendOutcomeAnalytics={props.sendOutcomeAnalytics}\n                  organization={props.organization}\n                  value={{\n                    isLoading,\n                    outcome,\n                  }}\n                >\n                  {props.children}\n                </Provider>\n              );\n            }}\n          </MetricsCompatibilitySumsQuery>\n        )}\n      </MetricsCompatibilityQuery>\n    </Fragment>\n  );\n}\n\nfunction Provider(\n  props: ComponentProps<typeof _Provider> & {\n    organization: Organization;\n    sendOutcomeAnalytics?: boolean;\n  }\n) {\n  const fallbackFromNull = props.value.outcome?.shouldWarnIncompatibleSDK ?? false;\n  const fallbackFromUnparam =\n    props.value.outcome?.shouldNotifyUnnamedTransactions ?? false;\n  const isOnMetrics = !props.value.outcome?.forceTransactionsOnly;\n  useEffect(() => {\n    if (!props.value.isLoading && props.sendOutcomeAnalytics) {\n      trackAdvancedAnalyticsEvent('performance_views.mep.metrics_outcome', {\n        organization: props.organization,\n        is_on_metrics: isOnMetrics,\n        fallback_from_null: fallbackFromNull,\n        fallback_from_unparam: fallbackFromUnparam,\n      });\n    }\n  }, [\n    props.organization,\n    props.value.isLoading,\n    isOnMetrics,\n    fallbackFromUnparam,\n    fallbackFromNull,\n    props.sendOutcomeAnalytics,\n  ]);\n  return <_Provider {...props}>{props.children}</_Provider>;\n}\n\nexport const MetricsCardinalityConsumer = _Context.Consumer;\n\nexport const useMetricsCardinalityContext = _useContext;\n\n/**\n * Logic for picking sides of metrics vs. transactions along with the associated warnings.\n */\nfunction getMetricsOutcome(\n  dataCounts: MergedMetricsData | null,\n  hasOtherFallbackCondition: boolean,\n  organization: Organization\n) {\n  const fallbackOutcome: MetricDataSwitcherOutcome = {\n    forceTransactionsOnly: true,\n  };\n  const successOutcome: MetricDataSwitcherOutcome = {\n    forceTransactionsOnly: false,\n  };\n  const isOnFallbackThresolds = organization.features.includes(\n    'performance-mep-bannerless-ui'\n  );\n\n  if (!dataCounts) {\n    return fallbackOutcome;\n  }\n  const compatibleProjects = dataCounts.compatible_projects;\n\n  if (hasOtherFallbackCondition) {\n    return fallbackOutcome;\n  }\n\n  if (!dataCounts) {\n    return fallbackOutcome;\n  }\n\n  if (checkNoDataFallback(dataCounts)) {\n    return fallbackOutcome;\n  }\n\n  if (checkIncompatibleData(dataCounts, isOnFallbackThresolds)) {\n    return {\n      shouldWarnIncompatibleSDK: true,\n      forceTransactionsOnly: true,\n      compatibleProjects,\n    };\n  }\n\n  if (checkIfAllOtherData(dataCounts)) {\n    return {\n      shouldNotifyUnnamedTransactions: true,\n      forceTransactionsOnly: true,\n      compatibleProjects,\n    };\n  }\n\n  if (checkIfPartialOtherData(dataCounts, isOnFallbackThresolds)) {\n    return {\n      shouldNotifyUnnamedTransactions: true,\n      compatibleProjects,\n      forceTransactionsOnly: false,\n    };\n  }\n\n  return successOutcome;\n}\n\n/**\n * Fallback if no metrics found.\n */\nfunction checkNoDataFallback(dataCounts: MergedMetricsData) {\n  const counts = normalizeCounts(dataCounts);\n  return !counts.metricsCount;\n}\n\n/**\n * Fallback and warn if incompatible data found (old specific SDKs).\n */\nfunction checkIncompatibleData(\n  dataCounts: MergedMetricsData,\n  isOnFallbackThresolds: boolean\n) {\n  const counts = normalizeCounts(dataCounts);\n  if (isOnFallbackThresolds) {\n    const ratio = counts.nullCount / counts.metricsCount;\n    return ratio > NULL_THRESHOLD;\n  }\n  return counts.nullCount > 0;\n}\n\n/**\n * Fallback and warn about unnamed transactions (specific SDKs).\n */\nfunction checkIfAllOtherData(dataCounts: MergedMetricsData) {\n  const counts = normalizeCounts(dataCounts);\n  return counts.unparamCount >= counts.metricsCount;\n}\n\n/**\n * Show metrics but warn about unnamed transactions.\n */\nfunction checkIfPartialOtherData(\n  dataCounts: MergedMetricsData,\n  isOnFallbackThresolds: boolean\n) {\n  const counts = normalizeCounts(dataCounts);\n  if (isOnFallbackThresolds) {\n    const ratio = counts.unparamCount / counts.metricsCount;\n    return ratio > UNPARAM_THRESHOLD;\n  }\n  return counts.unparamCount > 0;\n}\n\n/**\n * Temporary function, can be removed after API changes.\n */\nfunction normalizeCounts({sum}: MergedMetricsData) {\n  try {\n    const metricsCount = Number(sum.metrics);\n    const unparamCount = Number(sum.metrics_unparam);\n    const nullCount = Number(sum.metrics_null);\n    return {\n      metricsCount,\n      unparamCount,\n      nullCount,\n    };\n  } catch (_) {\n    return {\n      metricsCount: 0,\n      unparamCount: 0,\n      nullCount: 0,\n    };\n  }\n}\n\n/**\n * Performance optimization to limit the amount of rows scanned before showing the landing page.\n */\nfunction adjustEventViewTime(eventView: EventView) {\n  const _eventView = eventView.clone();\n\n  if (!_eventView.start && !_eventView.end) {\n    if (!_eventView.statsPeriod) {\n      _eventView.statsPeriod = '1h';\n      _eventView.start = undefined;\n      _eventView.end = undefined;\n    } else {\n      const periodHours = parsePeriodToHours(_eventView.statsPeriod);\n      if (periodHours > 1) {\n        _eventView.statsPeriod = '1h';\n        _eventView.start = undefined;\n        _eventView.end = undefined;\n      }\n    }\n  }\n  return _eventView;\n}\n","import {Dispatch, ReactNode, useCallback, useReducer} from 'react';\nimport {browserHistory} from 'react-router';\nimport {Location} from 'history';\n\nimport {Organization} from 'sentry/types';\nimport localStorage from 'sentry/utils/localStorage';\nimport {decodeScalar} from 'sentry/utils/queryString';\nimport useOrganization from 'sentry/utils/useOrganization';\n\nimport {createDefinedContext} from './utils';\n\nexport interface MetricsEnhancedSettingContext {\n  autoSampleState: AutoSampleState;\n  memoizationKey: string;\n  metricSettingState: MEPState | null;\n  setAutoSampleState: Dispatch<AutoSampleState>;\n  setMetricSettingState: Dispatch<MEPState>;\n  shouldQueryProvideMEPAutoParams: boolean;\n  shouldQueryProvideMEPMetricParams: boolean;\n  shouldQueryProvideMEPTransactionParams: boolean;\n}\n\nconst [_MEPSettingProvider, _useMEPSettingContext, _MEPSettingContext] =\n  createDefinedContext<MetricsEnhancedSettingContext>({\n    name: 'MetricsEnhancedSettingContext',\n  });\n\nexport const MEPConsumer = _MEPSettingContext.Consumer;\n\n/**\n * These will be called something else in the copy, but functionally the data is coming from metrics / transactions.\n * \"Unset\" should be the initial state before any queries return for the first time.\n */\nexport enum AutoSampleState {\n  unset = 'unset',\n  metrics = 'metrics',\n  transactions = 'transactions',\n}\n\n/**\n * Metrics/transactions will be called something else in the copy, but functionally the data is coming from metrics / transactions.\n */\nexport enum MEPState {\n  auto = 'auto',\n  metricsOnly = 'metricsOnly',\n  transactionsOnly = 'transactionsOnly',\n}\n\nexport const METRIC_SETTING_PARAM = 'metricSetting';\nexport const METRIC_SEARCH_SETTING_PARAM = 'metricSearchSetting'; // TODO: Clean this up since we don't need multiple params in practice.\n\nconst storageKey = 'performance.metrics-enhanced-setting';\nexport class MEPSetting {\n  static get(): MEPState | null {\n    const value = localStorage.getItem(storageKey);\n    if (value) {\n      if (!(value in MEPState)) {\n        localStorage.removeItem(storageKey);\n        return null;\n      }\n      return MEPState[value];\n    }\n    return null;\n  }\n\n  static set(value: MEPState) {\n    localStorage.setItem(storageKey, value);\n  }\n}\n\nexport function canUseMetricsDevUI(organization: Organization) {\n  return organization.features.includes('performance-use-metrics');\n}\n\nexport function canUseMetricsData(organization: Organization) {\n  const isDevFlagOn = canUseMetricsDevUI(organization); // Forces metrics data on as well.\n  const isInternalViewOn = organization.features.includes(\n    'performance-transaction-name-only-search'\n  ); // TODO: Swap this flag out.\n\n  const samplingRolloutFlag = organization.features.includes('dynamic-sampling');\n  const isRollingOut =\n    samplingRolloutFlag && organization.features.includes('mep-rollout-flag');\n\n  return isDevFlagOn || isInternalViewOn || isRollingOut;\n}\n\nexport function MEPSettingProvider({\n  children,\n  location,\n  _hasMEPState,\n  forceTransactions,\n}: {\n  children: ReactNode;\n  _hasMEPState?: MEPState;\n  forceTransactions?: boolean;\n  location?: Location;\n}) {\n  const organization = useOrganization();\n\n  const canUseMEP = canUseMetricsData(organization);\n\n  const allowedStates = [MEPState.metricsOnly, MEPState.transactionsOnly];\n  const _metricSettingFromParam = location\n    ? decodeScalar(location.query[METRIC_SETTING_PARAM])\n    : MEPState.metricsOnly;\n  let defaultMetricsState = MEPState.metricsOnly;\n\n  if (forceTransactions) {\n    defaultMetricsState = MEPState.transactionsOnly;\n  }\n\n  const metricSettingFromParam =\n    allowedStates.find(s => s === _metricSettingFromParam) ?? defaultMetricsState;\n\n  const isControlledMEP = typeof _hasMEPState !== 'undefined';\n\n  const [_metricSettingState, _setMetricSettingState] = useReducer(\n    (_: MEPState, next: MEPState) => next,\n    metricSettingFromParam\n  );\n\n  const setMetricSettingState = useCallback(\n    (settingState: MEPState) => {\n      if (!location) {\n        return;\n      }\n      browserHistory.replace({\n        ...location,\n        query: {\n          ...location.query,\n          [METRIC_SETTING_PARAM]: settingState,\n        },\n      });\n      _setMetricSettingState(settingState);\n    },\n    [location, _setMetricSettingState]\n  );\n\n  const [autoSampleState, setAutoSampleState] = useReducer(\n    (_: AutoSampleState, next: AutoSampleState) => next,\n    AutoSampleState.unset\n  );\n\n  const metricSettingState = isControlledMEP ? _hasMEPState : _metricSettingState;\n\n  const shouldQueryProvideMEPAutoParams =\n    canUseMEP && metricSettingState === MEPState.auto;\n  const shouldQueryProvideMEPMetricParams =\n    canUseMEP && metricSettingState === MEPState.metricsOnly;\n  const shouldQueryProvideMEPTransactionParams =\n    canUseMEP && metricSettingState === MEPState.transactionsOnly;\n\n  const memoizationKey = `${metricSettingState}`;\n\n  return (\n    <_MEPSettingProvider\n      value={{\n        autoSampleState,\n        metricSettingState,\n        shouldQueryProvideMEPAutoParams,\n        shouldQueryProvideMEPMetricParams,\n        shouldQueryProvideMEPTransactionParams,\n        memoizationKey,\n        setMetricSettingState,\n        setAutoSampleState,\n      }}\n    >\n      {children}\n    </_MEPSettingProvider>\n  );\n}\n\nexport const useMEPSettingContext = _useMEPSettingContext;\n","import EventView, {ImmutableEventView} from 'sentry/utils/discover/eventView';\n\nimport {createDefinedContext} from './utils';\n\ntype usePerformanceEventViewContext = {\n  eventView: EventView;\n};\n\nconst [\n  PerformanceEventViewProvider,\n  _usePerformanceEventView,\n  PerformanceEventViewContext,\n] = createDefinedContext<usePerformanceEventViewContext>({\n  name: 'PerformanceEventViewContext',\n});\n\nexport {PerformanceEventViewProvider, PerformanceEventViewContext};\n\n// Provides a readonly event view. Also omits anything that isn't currently read-only, although in the future we should switch the code in EventView instead.\n// If you need mutability, use the mutable version.\nexport function usePerformanceEventView(): ImmutableEventView {\n  return _usePerformanceEventView().eventView;\n}\n\nexport function useMutablePerformanceEventView() {\n  return usePerformanceEventView().clone();\n}\n","import {createContext, useContext} from 'react';\n\ntype CreateContextReturn<T> = [React.Provider<T>, () => T, React.Context<T>];\n/*\n * Creates provider, context and useContext hook, guarding against calling useContext without a provider.\n * [0]: https://github.com/chakra-ui/chakra-ui/blob/c0f9c287df0397e2aa9bd90eb3d5c2f2c08aa0b1/packages/utils/src/react-helpers.ts#L27\n *\n * Renamed to createDefinedContext to not conflate with React context.\n */\nexport function createDefinedContext<ContextType>(options: {\n  name: string;\n  errorMessage?: string;\n  strict?: boolean;\n}) {\n  const {\n    strict = true,\n    errorMessage = `useContext for \"${options.name}\" must be inside a Provider with a value`,\n    name,\n  } = options;\n\n  const Context = createContext<ContextType | undefined>(undefined);\n\n  Context.displayName = name;\n\n  function useDefinedContext() {\n    const context = useContext(Context);\n    if (!context && strict) {\n      throw new Error(errorMessage);\n    }\n    return context;\n  }\n\n  return [\n    Context.Provider,\n    useDefinedContext,\n    Context,\n  ] as CreateContextReturn<ContextType>;\n}\n","import {Location} from 'history';\n\nimport Feature from 'sentry/components/acl/feature';\nimport {Alert} from 'sentry/components/alert';\nimport * as Layout from 'sentry/components/layouts/thirds';\nimport NoProjectMessage from 'sentry/components/noProjectMessage';\nimport {t} from 'sentry/locale';\nimport {Organization} from 'sentry/types';\nimport {MetricsCardinalityProvider} from 'sentry/utils/performance/contexts/metricsCardinality';\nimport {MEPSettingProvider} from 'sentry/utils/performance/contexts/metricsEnhancedSetting';\nimport {QueryClient, QueryClientProvider} from 'sentry/utils/queryClient';\nimport withOrganization from 'sentry/utils/withOrganization';\n\ntype Props = {\n  children: React.ReactChildren;\n  location: Location;\n  organization: Organization;\n};\n\nconst queryClient = new QueryClient();\n\nfunction PerformanceContainer({organization, location, children}: Props) {\n  function renderNoAccess() {\n    return (\n      <Layout.Page withPadding>\n        <Alert type=\"warning\">{t(\"You don't have access to this feature\")}</Alert>\n      </Layout.Page>\n    );\n  }\n\n  return (\n    <Feature\n      hookName=\"feature-disabled:performance-page\"\n      features={['performance-view']}\n      organization={organization}\n      renderDisabled={renderNoAccess}\n    >\n      <NoProjectMessage organization={organization}>\n        <QueryClientProvider client={queryClient}>\n          <MetricsCardinalityProvider location={location} organization={organization}>\n            <MEPSettingProvider>{children}</MEPSettingProvider>\n          </MetricsCardinalityProvider>\n        </QueryClientProvider>\n      </NoProjectMessage>\n    </Feature>\n  );\n}\n\nexport default withOrganization(PerformanceContainer);\n"],"names":["QueryError","constructor","errorMessage","originalError","_defineProperty","this","message","getOriginalError","_GenericDiscoverQuery","Component","arguments","isLoading","tableFetchID","undefined","error","tableData","pageLinks","api","Client","prevProps","thisAPIPayload","getPayload","props","otherAPIPayload","isAPIPayloadSimilar","limit","route","cursor","parseError","detail","responseJSON","t","async","queryBatching","beforeFetch","afterFetch","didFetch","eventView","orgSlug","setError","state","isValid","url","Symbol","apiPayload","setState","clear","data","resp","doDiscoverQuery","prevState","getResponseHeader","err","_parseError","componentDidMount","fetchData","componentDidUpdate","refetchCondition","_shouldRefetchData","eventViewValidation","shouldRefetchExternal","shouldRefetchData","render","childrenProps","children","GenericDiscoverQuery","organizationSlug","useContext","OrganizationContext","slug","performanceEventView","PerformanceEventViewContext","Error","_props","_jsx","displayName","BASE_TIMEOUT","TIMEOUT_MULTIPLIER","wait","duration","Promise","resolve","setTimeout","params","options","length","retry","batchRequest","query","includeAllArgs","baseTimeout","timeoutMultiplier","statusCodes","maxTries","tries","timeout","includes","status","requestPromise","method","noPagination","referrer","getRequestPayload","location","forceAppendRawQueryString","payload","getEventsAPIPayload","per_page","Object","assign","queryExtras","useGenericDiscoverQuery","useApi","useQuery","_ref","omit","MetricsCompatibilityQuery","_ref2","_ref3","rest","MetricsCompatibilitySumsQuery","UNPARAM_THRESHOLD","NULL_THRESHOLD","_Provider","_useContext","_Context","createDefinedContext","name","strict","MetricsCardinalityProvider","canUseMetricsData","organization","value","outcome","forceTransactionsOnly","baseDiscoverProps","EventView","fields","field","_eventView","clone","start","end","statsPeriod","parsePeriodToHours","adjustEventViewTime","Fragment","compatabilityResult","sumsResult","dataCounts","hasOtherFallbackCondition","fallbackOutcome","isOnFallbackThresolds","features","compatibleProjects","compatible_projects","normalizeCounts","metricsCount","checkNoDataFallback","counts","nullCount","checkIncompatibleData","shouldWarnIncompatibleSDK","unparamCount","checkIfAllOtherData","shouldNotifyUnnamedTransactions","checkIfPartialOtherData","getMetricsOutcome","Provider","sendOutcomeAnalytics","fallbackFromNull","fallbackFromUnparam","isOnMetrics","useEffect","trackAdvancedAnalyticsEvent","is_on_metrics","fallback_from_null","fallback_from_unparam","Consumer","useMetricsCardinalityContext","sum","Number","metrics","metrics_unparam","metrics_null","_","_MEPSettingProvider","_useMEPSettingContext","_MEPSettingContext","MEPConsumer","AutoSampleState","MEPState","METRIC_SETTING_PARAM","METRIC_SEARCH_SETTING_PARAM","isDevFlagOn","canUseMetricsDevUI","isInternalViewOn","isRollingOut","MEPSettingProvider","_hasMEPState","forceTransactions","canUseMEP","useOrganization","allowedStates","metricsOnly","transactionsOnly","_metricSettingFromParam","decodeScalar","defaultMetricsState","metricSettingFromParam","find","s","isControlledMEP","_metricSettingState","_setMetricSettingState","useReducer","next","setMetricSettingState","useCallback","settingState","browserHistory","autoSampleState","setAutoSampleState","unset","metricSettingState","shouldQueryProvideMEPAutoParams","auto","shouldQueryProvideMEPMetricParams","shouldQueryProvideMEPTransactionParams","memoizationKey","useMEPSettingContext","PerformanceEventViewProvider","_usePerformanceEventView","Context","createContext","context","queryClient","QueryClient","PerformanceContainer","Feature","hookName","renderDisabled","Layout","withPadding","Alert","type","NoProjectMessage","QueryClientProvider","client","withOrganization"],"sourceRoot":""}