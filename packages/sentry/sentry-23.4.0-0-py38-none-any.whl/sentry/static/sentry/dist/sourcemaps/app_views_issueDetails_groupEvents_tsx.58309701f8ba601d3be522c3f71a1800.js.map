{"version":3,"file":"chunks/app_views_issueDetails_groupEvents_tsx.xxxxxxxxxxxxxxxxxxxx.js","mappings":"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","sources":["webpack:///./app/utils/useCleanQueryParamsOnRouteLeave.tsx","webpack:///./app/views/issueDetails/allEventsTable.tsx","webpack:///./app/views/issueDetails/groupEvents.tsx"],"sourcesContent":["import {useCallback, useEffect} from 'react';\nimport {browserHistory} from 'react-router';\nimport type {Location} from 'history';\n\nimport {useLocation} from 'sentry/utils/useLocation';\n\ntype Opts = {\n  fieldsToClean: string[];\n};\n\nexport function handleRouteLeave<Q extends object>({\n  fieldsToClean,\n  newLocation,\n  oldPathname,\n}: {\n  fieldsToClean: string[];\n  newLocation: Location<Q>;\n  oldPathname: string;\n}) {\n  const hasSomeValues = fieldsToClean.some(\n    field => newLocation.query[field] !== undefined\n  );\n\n  if (newLocation.pathname === oldPathname || !hasSomeValues) {\n    return;\n  }\n\n  // Removes fields from the URL on route leave so that the parameters will\n  // not interfere with other pages\n  const query = fieldsToClean.reduce(\n    (newQuery, field) => {\n      newQuery[field] = undefined;\n      return newQuery;\n    },\n    {...newLocation.query}\n  );\n\n  browserHistory.replace({\n    pathname: newLocation.pathname,\n    query,\n  });\n}\n\nfunction useCleanQueryParamsOnRouteLeave({fieldsToClean}: Opts) {\n  const location = useLocation();\n\n  const onRouteLeave = useCallback(\n    newLocation => {\n      handleRouteLeave({\n        fieldsToClean,\n        newLocation,\n        oldPathname: location.pathname,\n      });\n    },\n    [location.pathname, fieldsToClean]\n  );\n\n  useEffect(() => {\n    return browserHistory.listen(onRouteLeave);\n  }, [onRouteLeave]);\n}\n\nexport default useCleanQueryParamsOnRouteLeave;\n","import {useEffect, useState} from 'react';\nimport {Location} from 'history';\n\nimport LoadingError from 'sentry/components/loadingError';\nimport {\n  PlatformCategory,\n  PlatformKey,\n  profiling as PROFILING_PLATFORMS,\n} from 'sentry/data/platformCategories';\nimport {t} from 'sentry/locale';\nimport {Group, IssueCategory, Organization} from 'sentry/types';\nimport EventView, {decodeSorts} from 'sentry/utils/discover/eventView';\nimport {DiscoverDatasets} from 'sentry/utils/discover/types';\nimport {getConfigForIssueType} from 'sentry/utils/issueTypeConfig';\nimport {platformToCategory} from 'sentry/utils/platform';\nimport {useRoutes} from 'sentry/utils/useRoutes';\nimport EventsTable from 'sentry/views/performance/transactionSummary/transactionEvents/eventsTable';\n\nexport interface Props {\n  group: Group;\n  issueId: string;\n  location: Location;\n  organization: Organization;\n  excludedTags?: string[];\n}\n\nfunction AllEventsTable(props: Props) {\n  const {location, organization, issueId, excludedTags, group} = props;\n  const config = getConfigForIssueType(props.group);\n  const [error, setError] = useState<string>('');\n  const routes = useRoutes();\n  const {fields, columnTitles} = getColumns(group, organization);\n\n  const eventView: EventView = EventView.fromLocation(props.location);\n  if (config.usesIssuePlatform) {\n    eventView.dataset = DiscoverDatasets.ISSUE_PLATFORM;\n  }\n  eventView.fields = fields.map(fieldName => ({field: fieldName}));\n\n  eventView.sorts = decodeSorts(location).filter(sort => fields.includes(sort.field));\n\n  useEffect(() => {\n    setError('');\n  }, [eventView.query]);\n\n  if (!eventView.sorts.length) {\n    eventView.sorts = [{field: 'timestamp', kind: 'desc'}];\n  }\n\n  const idQuery =\n    group.issueCategory === IssueCategory.PERFORMANCE\n      ? `performance.issue_ids:${issueId} event.type:transaction`\n      : `issue.id:${issueId}`;\n  eventView.project = [parseInt(group.project.id, 10)];\n  eventView.query = `${idQuery} ${props.location.query.query || ''}`;\n  eventView.statsPeriod = '90d';\n\n  if (error) {\n    return <LoadingError message={error} onRetry={() => setError('')} />;\n  }\n\n  return (\n    <EventsTable\n      eventView={eventView}\n      location={location}\n      issueId={issueId}\n      organization={organization}\n      routes={routes}\n      excludedTags={excludedTags}\n      projectSlug={group.project.slug}\n      customColumns={['minidump']}\n      setError={(msg: string | undefined) => setError(msg ?? '')}\n      transactionName=\"\"\n      columnTitles={columnTitles.slice()}\n      referrer=\"api.issues.issue_events\"\n    />\n  );\n}\n\ntype ColumnInfo = {columnTitles: string[]; fields: string[]};\n\nconst getColumns = (group: Group, organization: Organization): ColumnInfo => {\n  const isPerfIssue = group.issueCategory === IssueCategory.PERFORMANCE;\n  const isReplayEnabled = organization.features.includes('session-replay');\n\n  // profiles only exist on transactions, so this only works with\n  // performance issues, and not errors\n  const isProfilingEnabled = isPerfIssue && organization.features.includes('profiling');\n\n  const {fields: platformSpecificFields, columnTitles: platformSpecificColumnTitles} =\n    getPlatformColumns(group.project.platform ?? group.platform, {\n      isProfilingEnabled,\n      isReplayEnabled,\n    });\n\n  const fields: string[] = [\n    'id',\n    'transaction',\n    'title',\n    'release',\n    'environment',\n    'user.display',\n    'device',\n    'os',\n    ...platformSpecificFields,\n    ...(isPerfIssue ? ['transaction.duration'] : []),\n    'timestamp',\n  ];\n\n  const columnTitles: string[] = [\n    t('event id'),\n    t('transaction'),\n    t('title'),\n    t('release'),\n    t('environment'),\n    t('user'),\n    t('device'),\n    t('os'),\n    ...platformSpecificColumnTitles,\n    ...(isPerfIssue ? [t('total duration')] : []),\n    t('timestamp'),\n    t('minidump'),\n  ];\n\n  return {\n    fields,\n    columnTitles,\n  };\n};\n\nconst getPlatformColumns = (\n  platform: PlatformKey | undefined,\n  options: {isProfilingEnabled: boolean; isReplayEnabled: boolean}\n): ColumnInfo => {\n  const replayField = options.isReplayEnabled ? ['replayId'] : [];\n  const replayColumnTitle = options.isReplayEnabled ? [t('replay')] : [];\n\n  const backendServerlessColumnInfo = {\n    fields: ['url', 'runtime'],\n    columnTitles: [t('url'), t('runtime')],\n  };\n\n  const categoryToColumnMap: Record<PlatformCategory, ColumnInfo> = {\n    [PlatformCategory.BACKEND]: backendServerlessColumnInfo,\n    [PlatformCategory.SERVERLESS]: backendServerlessColumnInfo,\n    [PlatformCategory.FRONTEND]: {\n      fields: ['url', 'browser', ...replayField],\n      columnTitles: [t('url'), t('browser'), ...replayColumnTitle],\n    },\n    [PlatformCategory.MOBILE]: {\n      fields: ['url'],\n      columnTitles: [t('url')],\n    },\n    [PlatformCategory.DESKTOP]: {\n      fields: [],\n      columnTitles: [],\n    },\n    [PlatformCategory.OTHER]: {\n      fields: [],\n      columnTitles: [],\n    },\n  };\n\n  const platformCategory = platformToCategory(platform);\n  const platformColumns = categoryToColumnMap[platformCategory];\n\n  if (options.isProfilingEnabled && platform && PROFILING_PLATFORMS.includes(platform)) {\n    platformColumns.columnTitles.push(t('profile'));\n    platformColumns.fields.push('profile.id');\n  }\n\n  return platformColumns;\n};\n\nexport default AllEventsTable;\n","import {Component} from 'react';\nimport {browserHistory, RouteComponentProps} from 'react-router';\nimport styled from '@emotion/styled';\n\nimport {Client} from 'sentry/api';\nimport EventSearchBar from 'sentry/components/events/searchBar';\nimport * as Layout from 'sentry/components/layouts/thirds';\nimport {space} from 'sentry/styles/space';\nimport {Group, Organization} from 'sentry/types';\nimport {handleRouteLeave} from 'sentry/utils/useCleanQueryParamsOnRouteLeave';\nimport withApi from 'sentry/utils/withApi';\nimport {normalizeUrl} from 'sentry/utils/withDomainRequired';\nimport withOrganization from 'sentry/utils/withOrganization';\n\nimport AllEventsTable from './allEventsTable';\n\ntype Props = {\n  api: Client;\n  group: Group;\n  organization: Organization;\n} & RouteComponentProps<{groupId: string}, {}>;\n\ninterface State {\n  query: string;\n}\n\nconst excludedTags = ['environment', 'issue', 'issue.id', 'performance.issue_ids'];\n\nclass GroupEvents extends Component<Props, State> {\n  constructor(props: Props) {\n    super(props);\n\n    const queryParams = this.props.location.query;\n\n    this.state = {\n      query: queryParams.query || '',\n    };\n  }\n\n  UNSAFE_componentWillReceiveProps(nextProps: Props) {\n    if (this.props.location.search !== nextProps.location.search) {\n      const queryParams = nextProps.location.query;\n\n      this.setState({\n        query: queryParams.query,\n      });\n    }\n  }\n\n  UNSAFE_componentDidMount() {\n    this._unsubscribeHandleRouteLeave = browserHistory.listen(newLocation =>\n      handleRouteLeave({\n        fieldsToClean: ['cursor'],\n        newLocation,\n        oldPathname: this.props.location.pathname,\n      })\n    );\n  }\n\n  UNSAFE_componentWillUnmount() {\n    this._unsubscribeHandleRouteLeave?.();\n  }\n\n  _unsubscribeHandleRouteLeave: undefined | ReturnType<typeof browserHistory.listen>;\n\n  handleSearch = (query: string) => {\n    const targetQueryParams = {...this.props.location.query};\n    targetQueryParams.query = query;\n    const {organization} = this.props;\n    const {groupId} = this.props.params;\n\n    browserHistory.push(\n      normalizeUrl({\n        pathname: `/organizations/${organization.slug}/issues/${groupId}/events/`,\n        query: targetQueryParams,\n      })\n    );\n  };\n\n  render() {\n    return (\n      <Layout.Body>\n        <Layout.Main fullWidth>\n          <AllEventsFilters>\n            <EventSearchBar\n              organization={this.props.organization}\n              defaultQuery=\"\"\n              onSearch={this.handleSearch}\n              excludedTags={excludedTags}\n              query={this.state.query}\n              hasRecentSearches={false}\n            />\n          </AllEventsFilters>\n          <AllEventsTable\n            issueId={this.props.group.id}\n            location={this.props.location}\n            organization={this.props.organization}\n            group={this.props.group}\n            excludedTags={excludedTags}\n          />\n        </Layout.Main>\n      </Layout.Body>\n    );\n  }\n}\n\nconst AllEventsFilters = styled('div')`\n  margin-bottom: ${space(2)};\n`;\n\nexport {GroupEvents};\n\nexport default withOrganization(withApi(GroupEvents));\n"],"names":["handleRouteLeave","_ref","fieldsToClean","newLocation","oldPathname","hasSomeValues","some","field","undefined","query","pathname","reduce","newQuery","browserHistory","_ref2","location","useLocation","onRouteLeave","useCallback","useEffect","AllEventsTable","props","organization","issueId","excludedTags","group","config","getConfigForIssueType","error","setError","useState","routes","useRoutes","fields","columnTitles","getColumns","eventView","EventView","usesIssuePlatform","dataset","DiscoverDatasets","map","fieldName","sorts","decodeSorts","filter","sort","includes","length","kind","idQuery","issueCategory","IssueCategory","project","parseInt","id","statsPeriod","_jsx","LoadingError","message","onRetry","EventsTable","projectSlug","slug","customColumns","msg","transactionName","slice","referrer","displayName","isPerfIssue","isReplayEnabled","features","isProfilingEnabled","platformSpecificFields","platformSpecificColumnTitles","getPlatformColumns","platform","t","options","replayField","replayColumnTitle","backendServerlessColumnInfo","platformColumns","PlatformCategory","platformToCategory","PROFILING_PLATFORMS","push","GroupEvents","Component","constructor","super","_defineProperty","targetQueryParams","this","groupId","params","normalizeUrl","queryParams","state","UNSAFE_componentWillReceiveProps","nextProps","search","setState","UNSAFE_componentDidMount","_unsubscribeHandleRouteLeave","UNSAFE_componentWillUnmount","render","Layout","children","_jsxs","fullWidth","AllEventsFilters","EventSearchBar","defaultQuery","onSearch","handleSearch","hasRecentSearches","_styled","target","space","withOrganization","withApi"],"sourceRoot":""}