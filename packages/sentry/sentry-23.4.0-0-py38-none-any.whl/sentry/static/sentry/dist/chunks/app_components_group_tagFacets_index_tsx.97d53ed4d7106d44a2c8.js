"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_components_group_tagFacets_index_tsx"],{"./app/components/group/tagFacets/index.tsx":(e,t,a)=>{a.d(t,{$c:()=>Z,Ix:()=>w,Pf:()=>v,Rj:()=>y,V6:()=>b,WN:()=>O,ZP:()=>k});var o=a("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),i=a("../node_modules/react/index.js"),n=a("../node_modules/lodash/keyBy.js"),s=a.n(n),r=a("./app/components/placeholder.tsx"),l=a("./app/components/sidebarSection.tsx"),d=a("./app/locale.tsx"),c=a("./app/styles/space.tsx"),p=a("./app/utils/formatters.tsx"),g=a("./app/utils/queryString.tsx"),u=a("./app/utils/useApi.tsx"),m=a("./app/utils/useLocation.tsx"),h=a("./app/utils/useOrganization.tsx"),x=a("./app/components/group/tagFacets/tagFacetsDistributionMeter.tsx"),f=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const Z=["device","device.class","os","release","environment","transaction"],y=["browser","transaction","release","url","environment"],v=["transaction","url","user","release","organization.slug"],b=["transaction","environment","release"];function w(e){const t={};return Object.keys(e).forEach((a=>{t[a]="release"===a?{...e[a],topValues:e[a].topValues.map((e=>({...e,name:(0,p.ko)(e.name)})))}:"device"===a?{...e[a],topValues:e[a].topValues.map((e=>({...e,name:e.readable??e.name})))}:e[a]})),t}const D=4;function k(e){let{tagKeys:t,environments:a,groupId:o,title:n,tagFormatter:c,project:p}=e;const[g,m]=(0,i.useState)({tagsData:{},loading:!0}),x=(0,h.Z)(),Z=(0,u.Z)();(0,i.useEffect)((()=>{m({...g,loading:!0}),(async()=>{const e=await Z.requestPromise(`/issues/${o}/tags/`,{query:{environment:a.map((e=>e.name)),readable:!0,limit:D}}),t=s()(e,"key");m({...g,tagsData:t,loading:!1})})().catch((()=>{m({...g,tagsData:{},loading:!1})}))}),[Z,JSON.stringify(a),o,t]);const y=c?.(g.tagsData)??g.tagsData;x.features.includes("device-classification")||delete y["device.class"];const v=t.filter((e=>Object.keys(y).includes(e))),b=Object.keys(y).filter((e=>!t.includes(e))).sort();return(0,f.tZ)(l.Eq,{children:g.loading||!y?(0,f.BX)(j,{children:[(0,f.tZ)(r.Z,{height:"40px"}),(0,f.tZ)(r.Z,{height:"40px"}),(0,f.tZ)(r.Z,{height:"40px"}),(0,f.tZ)(r.Z,{height:"40px"})]}):(0,f.BX)(i.Fragment,{children:[(0,f.tZ)(l.Dx,{children:n||(0,d.t)("All Tags")}),0===Object.keys(y).length?(0,f.tZ)(F,{"data-test-id":"no-tags",children:a.length?(0,d.t)("No tags found in the selected environments"):(0,d.t)("No tags found")}):(0,f.BX)(_,{children:[(0,f.tZ)("span",{"data-test-id":"top-distribution-wrapper",children:(0,f.tZ)(z,{groupId:o,organization:x,project:p,tagKeys:v,tagsData:y,expandFirstTag:!0})}),(0,f.tZ)(z,{groupId:o,organization:x,project:p,tagKeys:b,tagsData:y})]})]})})}function z(e){let{groupId:t,organization:a,project:o,tagKeys:i,tagsData:n,expandFirstTag:s}=e;const r=(0,m.T)(),l={...r.query};return(0,f.tZ)(O,{children:i.map(((e,i)=>{const d=n[e],c=d?d.topValues:[],p=d?d.totalValues:0,u=`/organizations/${a.slug}/issues/${t}/tags/${e}/?referrer=tag-distribution-meter`,m=`/organizations/${a.slug}/issues/${t}/events/`,h=c?c.map((t=>{const a={...r,query:{...l,query:(0,g.os)(null,e,t.value)},pathname:m};return{...t,url:a}})):[];return(0,f.tZ)("li",{"aria-label":e,children:(0,f.tZ)(x.Z,{title:e,totalValues:p,segments:h,onTagClick:()=>{},project:o,expandByDefault:s&&0===i,otherUrl:u})},e)}))})}k.displayName="TagFacets",z.displayName="TagFacetsDistributionMeterWrapper";const j=(0,o.Z)("div",{target:"e1dti8s93"})("display:grid;gap:",(0,c.D)(1),";grid-auto-flow:row;"),_=(0,o.Z)("div",{target:"e1dti8s92"})("margin-top:",(0,c.D)(2),";"),F=(0,o.Z)("p",{target:"e1dti8s91"})("margin-top:",(0,c.D)(.5),";"),O=(0,o.Z)("ol",{target:"e1dti8s90"})("list-style:none;padding:0;margin:0 0 ",(0,c.D)(2),";")},"./app/components/group/tagFacets/tagFacetsDistributionMeter.tsx":(e,t,a)=>{a.d(t,{Z:()=>z});var o=a("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),i=(a("../node_modules/core-js/modules/es.array.push.js"),a("../node_modules/react/index.js")),n=a("../node_modules/@emotion/is-prop-valid/dist/is-prop-valid.browser.esm.js"),s=a("../node_modules/framer-motion/dist/es/render/dom/motion.mjs"),r=a("../node_modules/lodash/debounce.js"),l=a.n(r),d=a("./app/components/button.tsx"),c=a("./app/components/links/link.tsx"),p=a("./app/components/tooltip.tsx"),g=a("./app/icons/iconChevron.tsx"),u=a("./app/locale.tsx"),m=a("./app/styles/space.tsx"),h=a("./app/utils.tsx"),x=a("./app/utils/analytics/trackAdvancedAnalyticsEvent.tsx"),f=a("./app/utils/platform.tsx"),Z=a("./app/utils/queryString.tsx"),y=a("./app/utils/useLocation.tsx"),v=a("./app/utils/useOrganization.tsx"),b=a("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const w=["#402A65","#694D99","#9A81C4","#BBA6DF","#EAE2F8"],D=l()((e=>{let{tag:t,value:a,platform:o,is_mobile:i,organization:n}=e;(0,x.Z)("issue_group_details.tags.bar.hovered",{tag:t,value:a,platform:o,is_mobile:i,organization:n})}),300);function k(e){let{colors:t=w,segments:a,title:o,totalValues:n,onTagClick:s,project:r,expandByDefault:l,otherUrl:d}=e;const m=(0,y.T)(),k=(0,v.Z)(),[z,P]=(0,i.useState)(!!l),[K,L]=(0,i.useState)(null),W=a.slice(0,4),Q=W.reduce(((e,t)=>e+t.count),0),U=Q<n,J=(0,Z.u3)(m.query.query,o,W.map((e=>{let{value:t}=e;return t}))),R={...m,query:{...m.query,query:J}};return U&&W.push({isOther:!0,name:(0,u.t)("Other"),value:"other",count:n-Q,url:d??R??""}),(0,b.tZ)(j,{children:(0,b.BX)("details",{open:!0,"aria-expanded":z,onClick:e=>e.preventDefault(),children:[(0,b.tZ)(I,{children:(0,b.BX)(_,{clickable:!0,onClick:()=>P(!z),children:[!Array.isArray(a)||a.length<=0?(0,b.tZ)(O,{children:(0,b.tZ)(S,{children:o})}):(0,b.BX)(O,{children:[(0,b.tZ)(S,{children:o}),(0,b.tZ)(p.u,{skipWrapper:!0,delay:800,title:W[0].name||(0,u.t)("n/a"),children:(0,b.tZ)($,{children:W[0].name||(0,u.t)("n/a")})}),(0,b.tZ)(N,{borderless:!0,size:"zero",icon:(0,b.tZ)(g.g,{direction:z?"up":"down",size:"xs"}),"aria-label":(0,u.t)("%s %s tag distribution",z?"Collapse":"Expand",o)})]}),0===n?(0,b.tZ)(F,{children:(0,b.tZ)("p",{children:(0,u.t)("No recent data.")})}):(0,b.tZ)(F,{children:W.map(((e,a)=>{const i=(0,h.aQ)(e.count,n),l=Math.floor(i),d={index:a,onClick:()=>((0,x.Z)("issue_group_details.tags.bar.clicked",{tag:o,value:e.value,platform:r?.platform,is_mobile:(0,f.an)(r?.platform),organization:k}),s?.(o,e))};return(0,b.tZ)("div",{style:{width:i+"%"},onMouseOver:()=>{L(e),D({tag:o,value:e.value,platform:r?.platform,is_mobile:(0,f.an)(r?.platform),organization:k})},onMouseLeave:()=>L(null),children:e.isOther?(0,b.tZ)(q,{"aria-label":(0,u.t)("Other segment"),color:t[t.length-1]}):(0,b.tZ)(M,{"aria-label":`${e.value} ${(0,u.t)("segment")}`,color:t[a],...d,children:0===a&&l>6?`${l}%`:null})},e.isOther?"other":`segment-${e.value}`)}))})]})}),(0,b.tZ)(B,{expanded:z,animate:z?{height:"100%",opacity:1}:{height:"0",opacity:0},children:(0,b.tZ)(T,{children:W.map(((e,a)=>{const i=Math.floor((0,h.aQ)(e.count,n)),s=!!K&&K.value!==e.value,r=K?.value===e.value,l=e.isOther?(0,u.t)("Other %s tag values, %s of all events. View other tags.",o,`${i}%`):(0,u.t)("%s, %s, %s of all events. View events with this tag value.",o,e.value,`${i}%`);return(0,b.tZ)("li",{children:(0,b.tZ)(c.Z,{to:e.url,"aria-label":l,children:(0,b.BX)(C,{onMouseOver:()=>L(e),onMouseLeave:()=>L(null),children:[(0,b.tZ)(E,{color:t[e.isOther?t.length-1:a],focus:r}),(0,b.tZ)(p.u,{skipWrapper:!0,delay:800,title:e.name,children:(0,b.tZ)(V,{unfocus:s,children:e.name??(0,b.tZ)(X,{children:(0,u.t)("n/a")})})}),(0,b.tZ)(A,{children:`${i}%`})]})})},`segment-${e.name}-${a}`)}))})})]})})}k.displayName="TagFacetsDistributionMeter";const z=k,j=(0,o.Z)("div",{target:"e1g8texm16"})("margin-bottom:",(0,m.D)(2),";"),_=(0,o.Z)("span",{target:"e1g8texm15"})((e=>e.clickable?"cursor: pointer":null),";"),F=(0,o.Z)("div",{target:"e1g8texm14"})({name:"andpxo",styles:"display:flex;overflow:hidden"}),O=(0,o.Z)("div",{target:"e1g8texm13"})("display:flex;font-size:",(e=>e.theme.fontSizeMedium),";justify-content:space-between;margin-bottom:",(0,m.D)(.25),";line-height:1.1;"),S=(0,o.Z)("div",{target:"e1g8texm12"})("flex:none;color:",(e=>e.theme.textColor),";font-weight:bold;font-size:",(e=>e.theme.fontSizeMedium),";margin-right:",(0,m.D)(1),";align-self:center;"),$=(0,o.Z)("div",{target:"e1g8texm11"})((e=>e.theme.overflowEllipsis),";display:flex;color:",(e=>e.theme.gray300),";text-align:right;font-size:",(e=>e.theme.fontSizeMedium),";",(e=>e.theme.overflowEllipsis),";align-self:center;"),q=(0,o.Z)("span",{target:"e1g8texm10"})("display:block;width:100%;height:",(0,m.D)(2),";color:inherit;outline:none;background-color:",(e=>e.color),";"),M=(0,o.Z)("span",{shouldForwardProp:n.Z,target:"e1g8texm9"})("&:hover{color:",(e=>e.theme.white),";}display:block;width:100%;height:",(0,m.D)(2),";color:",(e=>e.theme.white),";outline:none;background-color:",(e=>e.color),";text-align:right;font-size:",(e=>e.theme.fontSizeExtraSmall),";padding:1px ",(0,m.D)(.5)," 0 0;"),B=(0,o.Z)(s.E.div,{shouldForwardProp:e=>"animate"===e||"expanded"!==e&&(0,n.Z)(e),target:"e1g8texm8"})("height:0;opacity:0;",(e=>e.expanded?"":"overflow: hidden;"),";"),T=(0,o.Z)("ol",{target:"e1g8texm7"})("list-style:none;padding:0;margin:",(0,m.D)(1)," 0;"),C=(0,o.Z)("div",{target:"e1g8texm6"})("display:flex;align-items:center;cursor:pointer;padding:",(0,m.D)(.5)," 0;"),E=(0,o.Z)("span",{target:"e1g8texm5"})("padding:0;position:relative;width:11px;height:11px;text-indent:-9999em;display:inline-block;border-radius:50%;flex-shrink:0;background-color:",(e=>e.color),";&:after{content:'';border-radius:50%;position:absolute;top:0;left:0;width:100%;height:100%;outline:",(e=>e.theme.gray100)," ",(0,m.D)(.5)," solid;opacity:",(e=>e.focus?"1":"0"),";transition:opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1);}"),V=(0,o.Z)("span",{target:"e1g8texm4"})("font-size:",(e=>e.theme.fontSizeSmall),";margin-left:",(0,m.D)(1),";overflow:hidden;white-space:nowrap;text-overflow:ellipsis;transition:color 0.3s;color:",(e=>e.unfocus?e.theme.gray300:e.theme.gray400),";"),A=(0,o.Z)("span",{target:"e1g8texm3"})("font-size:",(e=>e.theme.fontSizeSmall),";margin-left:",(0,m.D)(1),";color:",(e=>e.theme.gray300),";text-align:right;flex-grow:1;"),N=(0,o.Z)(d.zx,{target:"e1g8texm2"})("color:",(e=>e.theme.gray300),";margin-left:",(0,m.D)(.5),";"),X=(0,o.Z)("span",{target:"e1g8texm1"})("color:",(e=>e.theme.gray300),";"),I=(0,o.Z)("summary",{target:"e1g8texm0"})({name:"l4bt0f",styles:"&::-webkit-details-marker{display:none;}"})}}]);
//# sourceMappingURL=../sourcemaps/app_components_group_tagFacets_index_tsx.9a2b31190115ba43ed8671ae59a7e064.js.map