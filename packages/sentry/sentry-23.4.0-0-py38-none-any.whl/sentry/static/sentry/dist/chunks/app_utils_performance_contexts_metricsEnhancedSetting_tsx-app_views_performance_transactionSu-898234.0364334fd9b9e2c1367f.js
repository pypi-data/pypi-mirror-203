"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_utils_performance_contexts_metricsEnhancedSetting_tsx-app_views_performance_transactionSu-898234"],{"./app/utils/performance/contexts/metricsEnhancedSetting.tsx":(t,e,s)=>{s.d(e,{Eg:()=>x,gp:()=>f,kP:()=>S,nP:()=>p,nl:()=>u,oR:()=>m,tm:()=>y});var r=s("../node_modules/react/index.js"),n=s("../node_modules/react-router/es/index.js"),o=(s("./app/utils/localStorage.tsx"),s("./app/utils/queryString.tsx")),i=s("./app/utils/useOrganization.tsx"),a=s("./app/utils/performance/contexts/utils.tsx"),l=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const[c,d,h]=(0,a.n)({name:"MetricsEnhancedSettingContext"}),p=h.Consumer;let u,m;!function(t){t.unset="unset",t.metrics="metrics",t.transactions="transactions"}(u||(u={})),function(t){t.auto="auto",t.metricsOnly="metricsOnly",t.transactionsOnly="transactionsOnly"}(m||(m={}));const g="metricSetting",y="metricSearchSetting";function f(t){const e=function(t){return t.features.includes("performance-use-metrics")}(t),s=t.features.includes("performance-transaction-name-only-search"),r=t.features.includes("dynamic-sampling")&&t.features.includes("mep-rollout-flag");return e||s||r}function S(t){let{children:e,location:s,_hasMEPState:a,forceTransactions:d}=t;const h=f((0,i.Z)()),p=[m.metricsOnly,m.transactionsOnly],y=s?(0,o.ro)(s.query[g]):m.metricsOnly;let S=m.metricsOnly;d&&(S=m.transactionsOnly);const x=p.find((t=>t===y))??S,j=void 0!==a,[T,b]=(0,r.useReducer)(((t,e)=>e),x),P=(0,r.useCallback)((t=>{s&&(n.browserHistory.replace({...s,query:{...s.query,[g]:t}}),b(t))}),[s,b]),[Z,v]=(0,r.useReducer)(((t,e)=>e),u.unset),_=j?a:T,A=h&&_===m.auto,C=h&&_===m.metricsOnly,w=h&&_===m.transactionsOnly,O=`${_}`;return(0,l.tZ)(c,{value:{autoSampleState:Z,metricSettingState:_,shouldQueryProvideMEPAutoParams:A,shouldQueryProvideMEPMetricParams:C,shouldQueryProvideMEPTransactionParams:w,memoizationKey:O,setMetricSettingState:P,setAutoSampleState:v},children:e})}S.displayName="MEPSettingProvider";const x=d},"./app/views/performance/transactionSummary/transactionThresholdModal.tsx":(t,e,s)=>{s.d(e,{ZP:()=>w,fY:()=>C});var r=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),n=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=s("../node_modules/react/index.js"),i=s("../node_modules/lodash/cloneDeep.js"),a=s.n(i),l=s("../node_modules/lodash/set.js"),c=s.n(l),d=s("./app/actionCreators/indicator.tsx"),h=s("./app/components/button.tsx"),p=s("./app/components/buttonBar.tsx"),u=s("./app/components/forms/controls/selectControl.tsx"),m=s("./app/components/forms/fieldGroup/index.tsx"),g=s("./app/components/input.tsx"),y=s("./app/components/links/link.tsx"),f=s("./app/locale.tsx"),S=s("./app/styles/space.tsx"),x=s("./app/utils.tsx"),j=s("./app/utils/withApi.tsx"),T=s("./app/utils/withProjects.tsx"),b=s("./app/views/performance/transactionSummary/utils.tsx"),P=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");let Z;!function(t){t.TRANSACTION_DURATION="duration",t.LARGEST_CONTENTFUL_PAINT="lcp"}(Z||(Z={}));const v=[{label:(0,f.t)("Transaction Duration"),value:"duration"},{label:(0,f.t)("Largest Contentful Paint"),value:"lcp"}];class _ extends o.Component{constructor(){super(...arguments),(0,r.Z)(this,"state",{threshold:this.props.transactionThreshold,metric:this.props.transactionThresholdMetric,error:null}),(0,r.Z)(this,"handleApply",(t=>{t.preventDefault();const{api:e,closeModal:s,organization:r,transactionName:n,onApply:o}=this.props,i=this.getProject();if(!(0,x.ri)(i))return;const a=`/organizations/${r.slug}/project-transaction-threshold-override/`;e.requestPromise(a,{method:"POST",includeAllArgs:!0,query:{project:i.id},data:{transaction:n,threshold:this.state.threshold,metric:this.state.metric}}).then((()=>{s(),o&&o(this.state.threshold,this.state.metric)})).catch((t=>{this.setState({error:t});const e=t.responseJSON?.threshold??t.responseJSON?.non_field_errors??null;(0,d.Iw)(e)}))})),(0,r.Z)(this,"handleFieldChange",(t=>e=>{this.setState((s=>{const r=a()(s);return c()(r,t,e),{...r,errors:void 0}}))})),(0,r.Z)(this,"handleReset",(t=>{t.preventDefault();const{api:e,closeModal:s,organization:r,transactionName:n,onApply:o}=this.props,i=this.getProject();if(!(0,x.ri)(i))return;const a=`/organizations/${r.slug}/project-transaction-threshold-override/`;e.requestPromise(a,{method:"DELETE",includeAllArgs:!0,query:{project:i.id},data:{transaction:n}}).then((()=>{const t=`/projects/${r.slug}/${i.slug}/transaction-threshold/configure/`;this.props.api.requestPromise(t,{method:"GET",includeAllArgs:!0,query:{project:i.id}}).then((t=>{let[e]=t;this.setState({threshold:e.threshold,metric:e.metric}),s(),o&&o(this.state.threshold,this.state.metric)})).catch((t=>{const e=t.responseJSON?.threshold??null;(0,d.Iw)(e)}))})).catch((t=>{this.setState({error:t})}))}))}getProject(){const{projects:t,eventView:e,project:s}=this.props;if((0,x.ri)(s))return t.find((t=>t.id===s));const r=String(e.project[0]);return t.find((t=>t.id===r))}renderModalFields(){return(0,P.BX)(o.Fragment,{children:[(0,P.tZ)(m.Z,{"data-test-id":"response-metric",label:(0,f.t)("Calculation Method"),inline:!1,help:(0,f.t)("This determines which duration metric is used for the Response Time Threshold."),showHelpInTooltip:!0,flexibleControlStateSize:!0,stacked:!0,required:!0,children:(0,P.tZ)(u.Z,{required:!0,options:v.slice(),name:"responseMetric",label:(0,f.t)("Calculation Method"),value:this.state.metric,onChange:t=>{this.handleFieldChange("metric")(t.value)}})}),(0,P.tZ)(m.Z,{"data-test-id":"response-time-threshold",label:(0,f.t)("Response Time Threshold (ms)"),inline:!1,help:(0,f.t)("The satisfactory response time for the calculation method defined above. This is used to calculate Apdex and User Misery scores."),showHelpInTooltip:!0,flexibleControlStateSize:!0,stacked:!0,required:!0,children:(0,P.tZ)(g.Z,{type:"number",name:"threshold",required:!0,pattern:"[0-9]*(\\.[0-9]*)?",onChange:t=>{this.handleFieldChange("threshold")(t.target.value)},value:this.state.threshold,step:100,min:100})})]})}render(){const{Header:t,Body:e,Footer:s,organization:r,transactionName:n,eventView:i}=this.props,a=this.getProject(),l=i.clone();l.query=l.getQueryWithAdditionalConditions();const c=(0,b.e1)({orgSlug:r.slug,transaction:n,query:l.generateQueryStringObject(),projectID:a?.id});return(0,P.BX)(o.Fragment,{children:[(0,P.tZ)(t,{closeButton:!0,children:(0,P.tZ)("h4",{children:(0,f.t)("Transaction Settings")})}),(0,P.BX)(e,{children:[(0,P.tZ)(A,{children:(0,f._N)("The changes below will only be applied to [transaction]. To set it at a more global level, go to [projectSettings: Project Settings].",{transaction:(0,P.tZ)(y.Z,{to:c,children:n}),projectSettings:(0,P.tZ)(y.Z,{to:`/settings/${r.slug}/projects/${a?.slug}/performance/`})})}),this.renderModalFields()]}),(0,P.tZ)(s,{children:(0,P.BX)(p.ZP,{gap:1,children:[(0,P.tZ)(h.zx,{priority:"default",onClick:this.handleReset,"data-test-id":"reset-all",children:(0,f.t)("Reset All")}),(0,P.tZ)(h.zx,{"aria-label":(0,f.t)("Apply"),priority:"primary",onClick:this.handleApply,"data-test-id":"apply-threshold",children:(0,f.t)("Apply")})]})})]})}}_.displayName="TransactionThresholdModal";const A=(0,n.Z)("div",{target:"e16m24dg0"})("margin-bottom:",(0,S.D)(4),";"),C={name:"1yumxzh",styles:"width:100%;max-width:650px"},w=(0,j.Z)((0,T.Z)(_))}}]);
//# sourceMappingURL=../sourcemaps/app_utils_performance_contexts_metricsEnhancedSetting_tsx-app_views_performance_transactionSu-898234.2800254b8a4d1e04e207138e650ce56c.js.map