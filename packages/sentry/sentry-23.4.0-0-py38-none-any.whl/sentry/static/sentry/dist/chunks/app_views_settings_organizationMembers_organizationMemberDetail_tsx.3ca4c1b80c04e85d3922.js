"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_settings_organizationMembers_organizationMemberDetail_tsx"],{"./app/utils/isMemberDisabledFromLimit.tsx":(e,t,s)=>{function i(e){return e?.flags["member-limit:restricted"]??!1}s.d(t,{Z:()=>i})},"./app/views/settings/organizationMembers/organizationMemberDetail.tsx":(e,t,s)=>{s.r(t),s.d(t,{default:()=>G});var i=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),n=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=(s("../node_modules/core-js/modules/es.array.push.js"),s("../node_modules/core-js/modules/es.regexp.flags.js"),s("../node_modules/react/index.js")),a=s("../node_modules/@sentry/core/esm/exports.js"),r=s("../node_modules/lodash/isEqual.js"),l=s.n(r),d=s("./app/actionCreators/account.tsx"),m=s("./app/actionCreators/indicator.tsx"),c=s("./app/actionCreators/members.tsx"),h=s("./app/components/button.tsx"),p=s("./app/components/buttonBar.tsx"),u=s("./app/components/confirm.tsx"),g=s("./app/components/dateTime.tsx"),b=s("./app/components/errors/notFound.tsx"),Z=s("./app/components/forms/fieldGroup/index.tsx"),f=s("./app/components/hookOrDefault.tsx"),v=s("./app/components/links/externalLink.tsx"),x=s("./app/components/panels/index.tsx"),R=s("./app/components/textCopyInput.tsx"),w=s("./app/components/tooltip.tsx"),y=s("./app/icons/index.tsx"),S=s("./app/locale.tsx"),z=s("./app/stores/configStore.tsx"),C=s("./app/styles/space.tsx"),I=s("./app/utils/isMemberDisabledFromLimit.tsx"),k=s("./app/utils/teams.tsx"),B=s("./app/utils/withDomainRequired.tsx"),T=s("./app/utils/withOrganization.tsx"),_=s("./app/views/asyncView.tsx"),j=s("./app/views/settings/components/settingsPageHeader.tsx"),D=s("./app/views/settings/components/teamSelect.tsx"),X=s("./app/components/radio.tsx"),N=s("./app/views/settings/components/text/textBlock.tsx"),O=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const A=(0,n.Z)("label",{target:"e1vdkxph0"})({name:"ddvan8",styles:"display:flex;flex:1;align-items:center;margin-bottom:0"});class L extends o.Component{render(){const{disabled:e,enforceRetired:t,enforceAllowed:s,isCurrentUser:i,roleList:n,enforceIdpRoleRestricted:o,roleSelected:a,setSelected:r}=this.props;return(0,O.BX)(x.s_,{children:[(0,O.tZ)(x.V9,{children:(0,O.tZ)("div",{children:(0,S.t)("Organization Role")})}),o&&(0,O.tZ)(x.aU,{children:(0,S._N)("[person] organization-level role is managed through your organization's identity provider.",{person:i?"Your":"This member's"})}),(0,O.tZ)(x.N,{children:n.map((i=>{const{desc:n,name:l,id:d,allowed:m,isRetired:c}=i,h=e||t&&c||s&&!m||o;return(0,O.tZ)(x.Lv,{onClick:()=>!h&&r(d),css:h?{color:"grey",cursor:"default"}:{},children:(0,O.BX)(A,{children:[(0,O.tZ)(X.Z,{id:d,value:l,checked:d===a,readOnly:!0}),(0,O.BX)("div",{style:{flex:1,padding:"0 16px"},children:[l,(0,O.tZ)(N.Z,{noMargin:!0,children:(0,O.tZ)("div",{className:"help-block",children:n})})]})]})},d)}))})]})}}L.displayName="OrganizationRoleSelect";const M=L,F=(0,S.t)("Cannot be reset since user is in more than one organization"),E=(0,S.t)("Not enrolled in two-factor authentication"),q=(0,S.t)("You do not have permission to perform this action"),P=(0,S.t)("Cannot be reset since two-factor is required for this organization"),V=(0,f.Z)({hookName:"component:disabled-member-tooltip",defaultComponent:e=>{let{children:t}=e;return(0,O.tZ)(o.Fragment,{children:t})}});class $ extends _.Z{constructor(){super(...arguments),(0,i.Z)(this,"handleSave",(async()=>{const{organization:e,params:t}=this.props,{orgRole:s,teamRoles:i}=this.state;(0,m.E3)((0,S.t)("Saving...")),this.setState({busy:!0});try{const n=await(0,c.hS)(this.api,{orgId:e.slug,memberId:t.memberId,data:{orgRole:s,teamRoles:i}});this.setState({member:n,busy:!1}),(0,m.S9)((0,S.t)("Saved"))}catch(e){const t=e&&e.responseJSON&&e.responseJSON.detail||(0,S.t)("Could not save...");this.setState({busy:!1}),(0,m.Iw)(t)}})),(0,i.Z)(this,"handleInvite",(async e=>{const{organization:t,params:s}=this.props;(0,m.E3)((0,S.t)("Sending invite...")),this.setState({busy:!0});try{const i=await(0,c.R_)(this.api,{orgId:t.slug,memberId:s.memberId,regenerate:e});(0,m.S9)((0,S.t)("Sent invite!")),e&&this.setState((e=>({member:{...e.member,...i}})))}catch(e){(0,m.Iw)((0,S.t)("Could not send invite"))}this.setState({busy:!1})})),(0,i.Z)(this,"handle2faReset",(async()=>{const{organization:e,router:t}=this.props,{user:s}=this.state.member,i=s.authenticators.map((e=>(0,d.Hb)(this.api,s.id,e.id)));try{await Promise.all(i),t.push((0,B.D)(`/settings/${e.slug}/members/`)),(0,m.S9)((0,S.t)("All authenticators have been removed"))}catch(e){(0,m.Iw)((0,S.t)("Error removing authenticators")),a.Tb(e)}})),(0,i.Z)(this,"onAddTeam",(e=>{const t=[...this.state.teamRoles];-1===t.findIndex((t=>t.teamSlug===e))&&(t.push({teamSlug:e,role:null}),this.setState({teamRoles:t}))})),(0,i.Z)(this,"onRemoveTeam",(e=>{const t=this.state.teamRoles.filter((t=>t.teamSlug!==e));this.setState({teamRoles:t})})),(0,i.Z)(this,"onChangeOrgRole",(e=>this.setState({orgRole:e}))),(0,i.Z)(this,"onChangeTeamRole",((e,t)=>{if(!this.hasTeamRoles)return;const s=[...this.state.teamRoles],i=s.findIndex((t=>t.teamSlug===e));-1!==i&&(s[i]={...s[i],role:t},this.setState({teamRoles:s}))})),(0,i.Z)(this,"showResetButton",(()=>{const{organization:e}=this.props,{member:t}=this.state,{user:s}=t;return!(!s||!s.authenticators||e.require2FA)&&(s.authenticators.length>=1&&s.canReset2fa)})),(0,i.Z)(this,"getTooltip",(()=>{const{organization:e}=this.props,{member:t}=this.state,{user:s}=t;return s?s.authenticators?s.authenticators.length?s.canReset2fa?e.require2FA?P:"":F:E:q:""}))}get hasTeamRoles(){const{organization:e}=this.props;return e.features.includes("team-roles")}getDefaultState(){return{...super.getDefaultState(),member:null,orgRole:"",teamRoles:[]}}getEndpoints(){const{organization:e,params:t}=this.props;return[["member",`/organizations/${e.slug}/members/${t.memberId}/`]]}onRequestSuccess(e){let{data:t,stateKey:s}=e;if("member"===s){const{orgRole:e,teamRoles:s}=t;this.setState({orgRole:e,teamRoles:s})}}get memberDeactivated(){return(0,I.Z)(this.state.member)}get hasFormChanged(){const{member:e,orgRole:t,teamRoles:s}=this.state;return!(!e||t===e.orgRole&&l()(s,e?.teamRoles))}renderMemberStatus(e){return this.memberDeactivated?(0,O.tZ)("em",{children:(0,O.tZ)(V,{children:(0,S.t)("Deactivated")})}):e.expired?(0,O.tZ)("em",{children:(0,S.t)("Invitation Expired")}):e.pending?(0,O.tZ)("em",{children:(0,S.t)("Invitation Pending")}):(0,S.t)("Active")}renderBody(){const{organization:e}=this.props,{member:t,orgRole:s,teamRoles:i}=this.state;if(!t)return(0,O.tZ)(b.Z,{});const{access:n,features:a,orgRoleList:r}=e,l=n.includes("org:write")&&!this.memberDeactivated,d=n.includes("org:admin"),m=a.includes("team-roles"),{email:c,expired:f,pending:C,invite_link:I}=t,B=!f,T=!C,_=z.Z.get("user").email===c;return(0,O.BX)(o.Fragment,{children:[(0,O.tZ)(j.Z,{title:(0,O.BX)(o.Fragment,{children:[(0,O.tZ)("div",{children:t.name}),(0,O.tZ)(U,{children:(0,S.t)("Member Settings")})]})}),(0,O.BX)(x.s_,{children:[(0,O.tZ)(x.V9,{children:(0,S.t)("Basics")}),(0,O.BX)(x.N,{children:[(0,O.tZ)(x.Lv,{children:(0,O.BX)(H,{children:[(0,O.BX)("div",{children:[(0,O.tZ)(J,{children:(0,S.t)("Email")}),(0,O.tZ)("div",{children:(0,O.tZ)(v.Z,{href:`mailto:${c}`,children:c})})]}),(0,O.BX)("div",{children:[(0,O.tZ)(J,{children:(0,S.t)("Status")}),(0,O.tZ)("div",{"data-test-id":"member-status",children:this.renderMemberStatus(t)})]}),(0,O.BX)("div",{children:[(0,O.tZ)(J,{children:(0,S.t)("Added")}),(0,O.tZ)("div",{children:(0,O.tZ)(g.Z,{dateOnly:!0,date:t.dateCreated})})]})]})}),(0,O.tZ)(x.Lv,{children:I&&(0,O.BX)(Y,{children:[(0,O.BX)(K,{children:[(0,O.tZ)(J,{children:(0,S.t)("Invite Link")}),(0,O.tZ)(R.Z,{children:I}),(0,O.tZ)("p",{className:"help-block",children:(0,S.t)("This invite link can be used by anyone who knows it. Keep it secure!")})]}),(0,O.BX)(p.ZP,{gap:1,children:[B&&(0,O.tZ)(h.zx,{"data-test-id":"resend-invite",onClick:()=>this.handleInvite(!1),children:(0,S.t)("Resend Invite")}),(0,O.tZ)(h.zx,{onClick:()=>this.handleInvite(!0),title:(0,S.t)("Generate New Invite. This will invalidate the previous invite link!"),priority:"danger","aria-label":(0,S.t)("Generate New Invite"),icon:(0,O.tZ)(y.tr,{size:"sm"})})]})]})})]})]}),T&&(0,O.BX)(x.s_,{children:[(0,O.tZ)(x.V9,{children:(0,S.t)("Authentication")}),(0,O.tZ)(x.N,{children:(0,O.tZ)(Z.Z,{alignRight:!0,flexibleControlStateSize:!0,label:(0,S.t)("Reset two-factor authentication"),help:(0,S.t)("Resetting two-factor authentication will remove all two-factor authentication methods for this member."),children:(0,O.tZ)(w.u,{disabled:this.showResetButton(),title:this.getTooltip(),children:(0,O.tZ)(u.Z,{disabled:!this.showResetButton(),message:(0,S._N)("Are you sure you want to disable all two-factor authentication methods for [name]?",{name:t.name?t.name:"this member"}),onConfirm:this.handle2faReset,children:(0,O.tZ)(h.zx,{priority:"danger",children:(0,S.t)("Reset two-factor authentication")})})})})})]}),(0,O.tZ)(M,{enforceAllowed:!1,enforceIdpRoleRestricted:t.flags["idp:role-restricted"],enforceRetired:m,isCurrentUser:_,disabled:!l,roleList:r,roleSelected:s,setSelected:this.onChangeOrgRole}),(0,O.tZ)(k.Z,{slugs:t.teams,children:t=>{let{initiallyLoaded:n}=t;return(0,O.tZ)(D.Z,{enforceIdpProvisioned:!0,disabled:!l,isOrgOwner:d,organization:e,selectedOrgRole:s,selectedTeamRoles:i,onChangeTeamRole:this.onChangeTeamRole,onAddTeam:this.onAddTeam,onRemoveTeam:this.onRemoveTeam,loadingTeams:!n})}}),(0,O.tZ)(Q,{children:(0,O.tZ)(h.zx,{priority:"primary",busy:this.state.busy,onClick:this.handleSave,disabled:!l||!this.hasFormChanged,children:(0,S.t)("Save Member")})})]})}}const G=(0,T.Z)($),U=(0,n.Z)("div",{target:"e1mjm7f05"})("color:",(e=>e.theme.gray300),";font-weight:normal;font-size:",(e=>e.theme.fontSizeLarge),";"),H=(0,n.Z)("div",{target:"e1mjm7f04"})("display:grid;grid-auto-flow:column;grid-template-columns:2fr 1fr 1fr;gap:",(0,C.D)(2),";width:100%;@media (max-width: ",(e=>e.theme.breakpoints.small),"){grid-auto-flow:row;grid-template-columns:auto;}"),J=(0,n.Z)("div",{target:"e1mjm7f03"})("font-weight:bold;margin-bottom:",(0,C.D)(.5),";color:",(e=>e.theme.textColor),";"),K=(0,n.Z)("div",{target:"e1mjm7f02"})({name:"1ff36h2",styles:"flex-grow:1"}),Y=(0,n.Z)("div",{target:"e1mjm7f01"})("flex-grow:1;display:flex;gap:",(0,C.D)(1),";"),Q=(0,n.Z)("div",{target:"e1mjm7f00"})({name:"skgbeu",styles:"display:flex;justify-content:flex-end"})}}]);
//# sourceMappingURL=../sourcemaps/app_views_settings_organizationMembers_organizationMemberDetail_tsx.cb67c5e05e8462a41bacbba9206863e1.js.map