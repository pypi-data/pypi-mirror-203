"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_performance_index_tsx"],{"./app/utils/discover/genericDiscoverQuery.tsx":(e,t,n)=>{n.d(t,{AA:()=>x,JC:()=>w,ZP:()=>P,o:()=>m});var r=n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),s=(n("../node_modules/core-js/modules/es.error.cause.js"),n("../node_modules/react/index.js")),o=n("../node_modules/@tanstack/react-query/build/lib/useQuery.mjs"),i=n("./app/api.tsx"),a=n("./app/locale.tsx"),c=n("./app/utils/discover/eventView.tsx"),u=n("./app/utils/performance/contexts/performanceEventViewContext.tsx"),l=n("./app/views/organizationContext.tsx"),d=n("./app/utils/useApi.tsx"),p=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class m{constructor(e,t){(0,r.Z)(this,"message",void 0),(0,r.Z)(this,"originalError",void 0),this.message=e,this.originalError=t}getOriginalError(){return this.originalError}}class h extends s.Component{constructor(){super(...arguments),(0,r.Z)(this,"state",{isLoading:!0,tableFetchID:void 0,error:null,tableData:null,pageLinks:null,api:new i.KU}),(0,r.Z)(this,"_shouldRefetchData",(e=>{const t=b(this.props),n=b(e);return!(0,c.ze)(t,n)||e.limit!==this.props.limit||e.route!==this.props.route||e.cursor!==this.props.cursor})),(0,r.Z)(this,"_parseError",(e=>{if(this.props.parseError)return this.props.parseError(e);if(!e)return null;const t=e.responseJSON?.detail;if("string"==typeof t)return new m(t,e);const n=t?.message;return new m("string"==typeof n?n:(0,a.t)("An unknown error occurred."),e)})),(0,r.Z)(this,"fetchData",(async()=>{const{queryBatching:e,beforeFetch:t,afterFetch:n,didFetch:r,eventView:s,orgSlug:o,route:i,setError:a}=this.props,{api:c}=this.state;if(!s.isValid())return;const u=`/organizations/${o}/${i}/`,l=Symbol("tableFetchID"),d=b(this.props);this.setState({isLoading:!0,tableFetchID:l}),a?.(void 0),t?.(c),c.clear();try{const[t,,s]=await x(c,u,d,{queryBatching:e});if(this.state.tableFetchID!==l)return;const o=n?n(t,this.props):t;r?.(o),this.setState((e=>({isLoading:!1,tableFetchID:void 0,error:null,pageLinks:s?.getResponseHeader("Link")??e.pageLinks,tableData:o})))}catch(e){const t=this._parseError(e);this.setState({isLoading:!1,tableFetchID:void 0,error:t,tableData:null}),a&&a(t??void 0)}}))}componentDidMount(){this.fetchData()}componentDidUpdate(e){const t=this._shouldRefetchData(e),n=!1===e.eventView.isValid()&&this.props.eventView.isValid(),r=!!this.props.shouldRefetchData&&this.props.shouldRefetchData(e,this.props);(t||n||r)&&this.fetchData()}render(){const{isLoading:e,error:t,tableData:n,pageLinks:r}=this.state,s={isLoading:e,error:t,tableData:n,pageLinks:r},o=this.props.children;return o?.(s)}}function f(e){const t=(0,s.useContext)(l.g)?.slug,n=(0,s.useContext)(u.uL)?.eventView,r=e.orgSlug??t,o=e.eventView??n;if(void 0===r||void 0===o)throw new Error("GenericDiscoverQuery requires both an orgSlug and eventView");const i={...e,orgSlug:r,eventView:o};return(0,p.tZ)(h,{...i})}h.displayName="_GenericDiscoverQuery",f.displayName="GenericDiscoverQuery";const g=200,y=2,v=e=>new Promise((t=>setTimeout(t,e)));async function x(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const{queryBatching:s,retry:o}=r;if(s?.batchRequest)return s.batchRequest(e,t,{query:n,includeAllArgs:!0});const i=o?.baseTimeout??g,a=o?.timeoutMultiplier??y,c=o?.statusCodes??[],u=o?.tries??1;let l,d=0,p=0;for(;d<u&&(!l||c.includes(l.status));){p>0&&await v(p);try{return d++,await e.requestPromise(t,{method:"GET",includeAllArgs:!0,query:{...n}})}catch(e){l=e,p=i*a**(d-1)}}throw l}function b(e){const{cursor:t,limit:n,noPagination:r,referrer:s,getRequestPayload:o,eventView:i,location:a,forceAppendRawQueryString:c}=e,u=o?o(e):i.getEventsAPIPayload(a,c);return t&&(u.cursor=t),n&&(u.per_page=n),r&&(u.noPagination=r),s&&(u.referrer=s),Object.assign(u,e.queryExtras??{}),u}function w(e){const t=(0,d.Z)(),{orgSlug:n,route:r}=e,s=`/organizations/${n}/${r}/`,i=b(e);return(0,o.a)([r,i],(async()=>{const[n]=await x(t,s,i,{queryBatching:e.queryBatching});return n}))}const P=f},"./app/utils/performance/contexts/metricsCardinality.tsx":(e,t,n)=>{n.d(t,{BT:()=>P,e0:()=>_});var r=n("../node_modules/react/index.js"),s=n("./app/utils/analytics/trackAdvancedAnalyticsEvent.tsx"),o=n("./app/utils/dates.tsx"),i=n("./app/utils/discover/eventView.tsx"),a=n("./app/utils/performance/contexts/metricsEnhancedSetting.tsx"),c=n("../node_modules/lodash/omit.js"),u=n.n(c),l=n("./app/utils/discover/genericDiscoverQuery.tsx"),d=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function p(e){let{eventView:t,location:n}=e;return u()(t.getEventsAPIPayload(n),["field","sort","per_page","query"])}function m(e){let{children:t,...n}=e;return(0,d.tZ)(l.ZP,{route:"metrics-compatibility-sums",getRequestPayload:p,...n,children:e=>{let{tableData:n,...r}=e;return t({tableData:n,...r})}})}function h(e){let{eventView:t,location:n}=e;return u()(t.getEventsAPIPayload(n),["field","sort","per_page","query"])}function f(e){let{children:t,...n}=e;return(0,d.tZ)(l.ZP,{route:"metrics-compatibility",getRequestPayload:h,...n,children:e=>{let{tableData:n,...r}=e;return t({tableData:n,...r})}})}m.displayName="MetricsCompatibilityQuery",f.displayName="MetricsCompatibilitySumsQuery";var g=n("./app/utils/performance/contexts/utils.tsx");const y=.01,v=.01,[x,b,w]=(0,g.n)({name:"MetricsCardinalityContext",strict:!1});function P(e){if(!(0,a.gp)(e.organization))return(0,d.tZ)(x,{value:{isLoading:!1,outcome:{forceTransactionsOnly:!0}},children:e.children});const t={location:e.location,orgSlug:e.organization.slug,cursor:"0:0:0"},n=i.ZP.fromLocation(e.location);n.fields=[{field:"tpm()"}];const s=function(e){const t=e.clone();return t.start||t.end||(t.statsPeriod?(0,o.YJ)(t.statsPeriod)>1&&(t.statsPeriod="1h",t.start=void 0,t.end=void 0):(t.statsPeriod="1h",t.start=void 0,t.end=void 0)),t}(n);return(0,d.tZ)(r.Fragment,{children:(0,d.tZ)(m,{eventView:s,...t,children:n=>(0,d.tZ)(f,{eventView:s,...t,children:t=>{const r=n.isLoading||t.isLoading,s=n.isLoading||t.isLoading?void 0:function(e,t,n){const r={forceTransactionsOnly:!0},s=n.features.includes("performance-mep-bannerless-ui");if(!e)return r;const o=e.compatible_projects;return t?r:e?function(e){return!D(e).metricsCount}(e)?r:function(e,t){const n=D(e);return t?n.nullCount/n.metricsCount>v:n.nullCount>0}(e,s)?{shouldWarnIncompatibleSDK:!0,forceTransactionsOnly:!0,compatibleProjects:o}:function(e){const t=D(e);return t.unparamCount>=t.metricsCount}(e)?{shouldNotifyUnnamedTransactions:!0,forceTransactionsOnly:!0,compatibleProjects:o}:function(e,t){const n=D(e);return t?n.unparamCount/n.metricsCount>y:n.unparamCount>0}(e,s)?{shouldNotifyUnnamedTransactions:!0,compatibleProjects:o,forceTransactionsOnly:!1}:{forceTransactionsOnly:!1}:r}(n.tableData&&t.tableData?{...n.tableData,...t.tableData}:null,!!n.error&&!!t.error,e.organization);return(0,d.tZ)(C,{sendOutcomeAnalytics:e.sendOutcomeAnalytics,organization:e.organization,value:{isLoading:r,outcome:s},children:e.children})}})})})}function C(e){const t=e.value.outcome?.shouldWarnIncompatibleSDK??!1,n=e.value.outcome?.shouldNotifyUnnamedTransactions??!1,o=!e.value.outcome?.forceTransactionsOnly;return(0,r.useEffect)((()=>{!e.value.isLoading&&e.sendOutcomeAnalytics&&(0,s.Z)("performance_views.mep.metrics_outcome",{organization:e.organization,is_on_metrics:o,fallback_from_null:t,fallback_from_unparam:n})}),[e.organization,e.value.isLoading,o,n,t,e.sendOutcomeAnalytics]),(0,d.tZ)(x,{...e,children:e.children})}P.displayName="MetricsCardinalityProvider",C.displayName="Provider",w.Consumer;const _=b;function D(e){let{sum:t}=e;try{const e=Number(t.metrics);return{metricsCount:e,unparamCount:Number(t.metrics_unparam),nullCount:Number(t.metrics_null)}}catch(e){return{metricsCount:0,unparamCount:0,nullCount:0}}}},"./app/utils/performance/contexts/metricsEnhancedSetting.tsx":(e,t,n)=>{n.d(t,{Eg:()=>x,gp:()=>y,kP:()=>v,nP:()=>p,nl:()=>m,oR:()=>h,tm:()=>g});var r=n("../node_modules/react/index.js"),s=n("../node_modules/react-router/es/index.js"),o=(n("./app/utils/localStorage.tsx"),n("./app/utils/queryString.tsx")),i=n("./app/utils/useOrganization.tsx"),a=n("./app/utils/performance/contexts/utils.tsx"),c=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const[u,l,d]=(0,a.n)({name:"MetricsEnhancedSettingContext"}),p=d.Consumer;let m,h;!function(e){e.unset="unset",e.metrics="metrics",e.transactions="transactions"}(m||(m={})),function(e){e.auto="auto",e.metricsOnly="metricsOnly",e.transactionsOnly="transactionsOnly"}(h||(h={}));const f="metricSetting",g="metricSearchSetting";function y(e){const t=function(e){return e.features.includes("performance-use-metrics")}(e),n=e.features.includes("performance-transaction-name-only-search"),r=e.features.includes("dynamic-sampling")&&e.features.includes("mep-rollout-flag");return t||n||r}function v(e){let{children:t,location:n,_hasMEPState:a,forceTransactions:l}=e;const d=y((0,i.Z)()),p=[h.metricsOnly,h.transactionsOnly],g=n?(0,o.ro)(n.query[f]):h.metricsOnly;let v=h.metricsOnly;l&&(v=h.transactionsOnly);const x=p.find((e=>e===g))??v,b=void 0!==a,[w,P]=(0,r.useReducer)(((e,t)=>t),x),C=(0,r.useCallback)((e=>{n&&(s.browserHistory.replace({...n,query:{...n.query,[f]:e}}),P(e))}),[n,P]),[_,D]=(0,r.useReducer)(((e,t)=>t),m.unset),S=b?a:w,Z=d&&S===h.auto,E=d&&S===h.metricsOnly,j=d&&S===h.transactionsOnly,O=`${S}`;return(0,c.tZ)(u,{value:{autoSampleState:_,metricSettingState:S,shouldQueryProvideMEPAutoParams:Z,shouldQueryProvideMEPMetricParams:E,shouldQueryProvideMEPTransactionParams:j,memoizationKey:O,setMetricSettingState:C,setAutoSampleState:D},children:t})}v.displayName="MEPSettingProvider";const x=l},"./app/utils/performance/contexts/performanceEventViewContext.tsx":(e,t,n)=>{n.d(t,{bq:()=>s,uL:()=>i});var r=n("./app/utils/performance/contexts/utils.tsx");const[s,o,i]=(0,r.n)({name:"PerformanceEventViewContext"})},"./app/utils/performance/contexts/utils.tsx":(e,t,n)=>{n.d(t,{n:()=>s}),n("../node_modules/core-js/modules/es.error.cause.js");var r=n("../node_modules/react/index.js");function s(e){const{strict:t=!0,errorMessage:n=`useContext for "${e.name}" must be inside a Provider with a value`,name:s}=e,o=(0,r.createContext)(void 0);return o.displayName=s,[o.Provider,function(){const e=(0,r.useContext)(o);if(!e&&t)throw new Error(n);return e},o]}},"./app/views/performance/index.tsx":(e,t,n)=>{n.r(t),n.d(t,{default:()=>f});var r=n("./app/components/acl/feature.tsx"),s=n("./app/components/alert.tsx"),o=n("./app/components/layouts/thirds.tsx"),i=n("./app/components/noProjectMessage.tsx"),a=n("./app/locale.tsx"),c=n("./app/utils/performance/contexts/metricsCardinality.tsx"),u=n("./app/utils/performance/contexts/metricsEnhancedSetting.tsx"),l=n("./app/utils/queryClient.tsx"),d=n("./app/utils/withOrganization.tsx"),p=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const m=new l.Su;function h(e){let{organization:t,location:n,children:d}=e;return(0,p.tZ)(r.Z,{hookName:"feature-disabled:performance-page",features:["performance-view"],organization:t,renderDisabled:function(){return(0,p.tZ)(o.T3,{withPadding:!0,children:(0,p.tZ)(s.bZ,{type:"warning",children:(0,a.t)("You don't have access to this feature")})})},children:(0,p.tZ)(i.Z,{organization:t,children:(0,p.tZ)(l.aH,{client:m,children:(0,p.tZ)(c.BT,{location:n,organization:t,children:(0,p.tZ)(u.kP,{children:d})})})})})}h.displayName="PerformanceContainer";const f=(0,d.Z)(h)}}]);
//# sourceMappingURL=../sourcemaps/app_views_performance_index_tsx.7484686e6205930706a645afb42940e2.js.map