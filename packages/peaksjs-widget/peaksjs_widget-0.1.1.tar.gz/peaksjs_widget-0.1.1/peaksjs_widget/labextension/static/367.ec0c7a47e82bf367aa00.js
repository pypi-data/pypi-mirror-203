(self.webpackChunkpeaksjs_widget=self.webpackChunkpeaksjs_widget||[]).push([[367],{657:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MODULE_NAME=t.MODULE_VERSION=void 0;const n=i(147);t.MODULE_VERSION=n.version,t.MODULE_NAME=n.name},367:function(e,t,i){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PeaksJSView=t.PeaksJSModel=void 0;const s=i(657);i(204);const o=i(985),a=n(i(989)),l=n(i(600));class r{constructor(e){this._options=e}init(e){this.handleHeight=20,this._handle=new l.default.Rect({x:-4.5,y:0,width:10,height:this.handleHeight,fill:this._options.color}),this._line=new l.default.Line({stroke:this._options.color,strokeWidth:1}),e.add(this._handle),e.add(this._line),this.fitToView()}fitToView(){const e=this._options.layer.getHeight();this._handle.y(e/2-this.handleHeight/2),this._line.points([.5,0,.5,e])}timeUpdated(){}destroy(){}}function d(e){return new r(e)}class c extends o.DOMWidgetModel{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:c.model_name,_model_module:c.model_module,_model_module_version:c.model_module_version,_view_name:c.view_name,_view_module:c.view_module,_view_module_version:c.view_module_version})}}t.PeaksJSModel=c,c.serializers=Object.assign({zoomview:{deserialize:o.unpack_models},overview:{deserialize:o.unpack_models},play_button:{deserialize:o.unpack_models},save_button:{deserialize:o.unpack_models},audio:{deserialize:o.unpack_models}},o.DOMWidgetModel.serializers),c.model_name="PeaksJSModel",c.model_module=s.MODULE_NAME,c.model_module_version=s.MODULE_VERSION,c.view_name="PeaksJSView",c.view_module=s.MODULE_NAME,c.view_module_version=s.MODULE_VERSION;class m extends o.DOMWidgetView{render(){super.render(),this.model.on("change:zoomview",this.init_zoomview,this),this.model.on("change:overview",this.init_overview,this),this.model.on("change:play_button",this.init_play_button,this),this.model.on("change:save_button",this.init_save_button,this),this.model.on("change:audio",this.init_peaks,this),this.model.on("change:segments",this.segments_changed,this),this.model.on("change:points",this.points_changed,this),this.model.on("change:playing",this.toggle_playing,this),this.views=new o.ViewList(this.add_view,null,this);const e=this;this.listenTo(this.model,"change:segments",this.segments_changed),this.listenTo(this.model,"change:points",this.points_changed),this.displayed.then((()=>{e.init_zoomview(),e.init_overview(),e.init_play_button(),e.init_save_button(),e.init_peaks()})),this.views.update([this.model.get("zoomview"),this.model.get("overview"),this.model.get("play_button"),this.model.get("save_button"),this.model.get("audio")]).then((e=>e.map((e=>e.render()))));const t=this.model.get("element_id");$(this.el).attr("id",t)}add_view(e,t){return this.create_child_view(e,{parent:this}).then((e=>(e.trigger("displayed"),e))).catch((e=>e))}init_zoomview(){const e=this,t=this.model.get("element_id");this.views.views[0].then((i=>{e.zoomview=$(i.el).text("\n").attr("id","zoomview-"+t).attr("tabindex","0").css({width:"100%",height:"200px","white-space":"pre"}),e.model.get("as_container")&&$(e.el).append(e.zoomview)}))}init_overview(){const e=this,t=this.model.get("element_id");this.views.views[1].then((i=>{e.overview=$(i.el).text("\n").attr("id","overview-"+t).css({width:"100%",height:"15px","white-space":"pre"}),e.model.get("as_container")&&$(e.el).append(e.overview)}))}init_play_button(){const e=this.model,t=this;this.views.views[2].then((i=>{this.playBtn=$(i.el).on("click",(function(){const i=e.get("playing");e.set("playing",!i),e.save_changes(),t.touch(),t.send({playing:!i})})),t.model.get("as_container")&&$(this.el).append(this.playBtn)}))}init_save_button(){const e=this;this.views.views[3].then((t=>{$(e.el).append($(t.el).on("click",(function(){const t=document.createElement("a");t.href=e.audio.src,t.setAttribute("download",`${e.model.get("element_id")}.mp3`),document.body.appendChild(t),t.click()})))}))}init_peaks(){const e=this,t=new AudioContext,i=this.model.get("segments"),n=this.model.get("points");Promise.all(this.views.views).then((s=>{const o=s[4].el,l=s[0].el,r=s[1].el;$(e.el).append(o),e.audio=o;const c={zoomview:{container:l,waveformColor:"rgba(0,100,255,0.95)",playheadColor:"#000000",wheelMode:"scroll"},overview:{container:r,waveformColor:"rgba(0,100,255,0.95)",playheadColor:"#000000",showAxisLabels:!1,highlightOffset:0},zoomLevels:[16],mediaElement:o,webAudio:{audioContext:t,scale:16,multiChannel:!1},keyboard:!1,nudgeIncrement:1,segments:i,points:n,createSegmentMarker:d};a.default.init(c,(function(t,i){t||null==i?console.error("Failed to initialize Peaks instance: "+t.message):(e.peaks=i,i.views.getView("zoomview").setZoom({seconds:Math.min(o.duration,180)}),i.on("zoomview.click",(t=>{if(!t.evt.altKey||t.evt.shiftKey||t.evt.ctrlKey){if(t.evt.ctrlKey&&!t.evt.altKey&&!t.evt.shiftKey){const n={time:t.time,color:"#ff640e",editable:!0},{id:s}=i.points.add(n);e.send({newPoint:Object.assign(Object.assign({},n),{id:s})})}}else{const n={startTime:t.time,endTime:t.time+.1,editable:!0,id:e.model.get("id_count"),color:"#ff640e",labelText:""};i.segments.add(n),e.model.set("id_count",n.id+1),e.touch(),e.send({newSegment:n})}})),i.on("segments.click",(t=>{if(t.evt.altKey&&t.evt.shiftKey)i.segments.removeById(t.segment.id),e.send({removeSegment:{startTime:t.segment.startTime,endTime:t.segment.endTime,id:t.segment.id,color:t.segment.color,labelText:t.segment.labelText}}),t.evt.preventDefault();else if(t.evt.ctrlKey&&t.evt.altKey){const i=prompt("Enter segment label","0");t.segment.update({labelText:i}),e.send({editSegment:{startTime:t.segment.startTime,endTime:t.segment.endTime,id:t.segment.id,color:t.segment.color,labelText:i,editable:!0}})}else e.send({clickSegment:{startTime:t.segment.startTime,endTime:t.segment.endTime,id:t.segment.id,color:t.segment.color,labelText:t.segment.labelText,editable:t.segment.editable}})})),i.on("segments.dragend",(t=>{e.send({editSegment:{startTime:t.segment.startTime,endTime:t.segment.endTime,id:t.segment.id,color:t.segment.color,labelText:t.segment.labelText,editable:!0}})})),i.on("points.dragend",(t=>{e.send({editPoint:{time:t.point.time,id:t.point.id,color:t.point.color,labelText:t.point.labelText,editable:!0}})})),i.on("points.click",(t=>{if(t.evt.ctrlKey&&!t.evt.altKey&&t.evt.shiftKey)e.send({removePoint:{time:t.point.time,id:t.point.id,color:t.point.color,labelText:t.point.labelText}}),t.evt.preventDefault();else if(t.evt.ctrlKey&&t.evt.altKey){const i=prompt("Enter point label","0");t.point.update({labelText:i}),e.send({editPoint:{time:t.point.time,id:t.point.id,color:t.point.color,labelText:i,editable:!0}})}})),i.on("player.seeked",(e=>{})),l.addEventListener("keydown",(t=>{if("Space"===t.code)e.playBtn.trigger("click"),t.preventDefault();else if(t.code.includes("Arrow")){const e=i.player.getCurrentTime(),n=i.views.getView("zoomview"),s=n.getEndTime()-n.getStartTime();let o=.002;t.shiftKey&&(o=.02),"ArrowRight"===t.code?i.player.seek(e+s*o):"ArrowLeft"===t.code&&i.player.seek(e-s*o)}})),l.addEventListener("wheel",(t=>{const n=i.views.getView("zoomview");if(n&&t.ctrlKey){const i=n.getStartTime(),s=(n.getEndTime()-i)*(t.wheelDelta>0?1.1:.9);n.setZoom({seconds:Math.min(o.duration,Math.max(s,.356))}),t.preventDefault(),e.send({updateZoomView:{startTime:n.getStartTime(),endTime:n.getEndTime()}})}})),l.addEventListener("dblclick",(t=>{t.shiftKey?i.views.getView("zoomview").setZoom({seconds:i.player.getDuration()}):t.altKey||e.playBtn.trigger("click")})))}))}))}segments_changed(){let e=this.model.get("segments");this.peaks.segments.removeAll(),this.peaks.segments.add(e)}points_changed(){let e=this.model.get("points");this.peaks.points.removeAll(),this.peaks.points.add(e)}toggle_playing(){this.model.get("playing")?(this.peaks.player.play(),this.playBtn.children("i").removeClass("fa-play").addClass("fa-pause")):(this.peaks.player.pause(),this.playBtn.children("i").removeClass("fa-pause").addClass("fa-play"))}}t.PeaksJSView=m},889:(e,t,i)=>{(t=i(645)(!1)).push([e.id,"\n",""]),e.exports=t},645:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var i=function(e,t){var i,n,s,o=e[1]||"",a=e[3];if(!a)return o;if(t&&"function"==typeof btoa){var l=(i=a,n=btoa(unescape(encodeURIComponent(JSON.stringify(i)))),s="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(n),"/*# ".concat(s," */")),r=a.sources.map((function(e){return"/*# sourceURL=".concat(a.sourceRoot||"").concat(e," */")}));return[o].concat(r).concat([l]).join("\n")}return[o].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(i,"}"):i})).join("")},t.i=function(e,i,n){"string"==typeof e&&(e=[[null,e,""]]);var s={};if(n)for(var o=0;o<this.length;o++){var a=this[o][0];null!=a&&(s[a]=!0)}for(var l=0;l<e.length;l++){var r=[].concat(e[l]);n&&s[r[0]]||(i&&(r[2]?r[2]="".concat(i," and ").concat(r[2]):r[2]=i),t.push(r))}},t}},204:(e,t,i)=>{var n=i(379),s=i(889);"string"==typeof(s=s.__esModule?s.default:s)&&(s=[[e.id,s,""]]);n(s,{insert:"head",singleton:!1}),e.exports=s.locals||{}},379:(e,t,i)=>{"use strict";var n,s=function(){var e={};return function(t){if(void 0===e[t]){var i=document.querySelector(t);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(e){i=null}e[t]=i}return e[t]}}(),o=[];function a(e){for(var t=-1,i=0;i<o.length;i++)if(o[i].identifier===e){t=i;break}return t}function l(e,t){for(var i={},n=[],s=0;s<e.length;s++){var l=e[s],r=t.base?l[0]+t.base:l[0],d=i[r]||0,c="".concat(r," ").concat(d);i[r]=d+1;var m=a(c),p={css:l[1],media:l[2],sourceMap:l[3]};-1!==m?(o[m].references++,o[m].updater(p)):o.push({identifier:c,updater:g(p,t),references:1}),n.push(c)}return n}function r(e){var t=document.createElement("style"),n=e.attributes||{};if(void 0===n.nonce){var o=i.nc;o&&(n.nonce=o)}if(Object.keys(n).forEach((function(e){t.setAttribute(e,n[e])})),"function"==typeof e.insert)e.insert(t);else{var a=s(e.insert||"head");if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(t)}return t}var d,c=(d=[],function(e,t){return d[e]=t,d.filter(Boolean).join("\n")});function m(e,t,i,n){var s=i?"":n.media?"@media ".concat(n.media," {").concat(n.css,"}"):n.css;if(e.styleSheet)e.styleSheet.cssText=c(t,s);else{var o=document.createTextNode(s),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(o,a[t]):e.appendChild(o)}}function p(e,t,i){var n=i.css,s=i.media,o=i.sourceMap;if(s?e.setAttribute("media",s):e.removeAttribute("media"),o&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}var u=null,h=0;function g(e,t){var i,n,s;if(t.singleton){var o=h++;i=u||(u=r(t)),n=m.bind(null,i,o,!1),s=m.bind(null,i,o,!0)}else i=r(t),n=p.bind(null,i,t),s=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(i)};return n(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n(e=t)}else s()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=(void 0===n&&(n=Boolean(window&&document&&document.all&&!window.atob)),n));var i=l(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var n=0;n<i.length;n++){var s=a(i[n]);o[s].references--}for(var r=l(e,t),d=0;d<i.length;d++){var c=a(i[d]);0===o[c].references&&(o[c].updater(),o.splice(c,1))}i=r}}}},147:e=>{"use strict";e.exports=JSON.parse('{"name":"peaksjs-widget","version":"0.1.1","description":"ipywidget to interact with audio waveforms through peaks.js","keywords":["jupyter","jupyterlab","jupyterlab-extension","widgets"],"files":["lib/**/*.js","dist/*.js","css/*.css"],"homepage":"https://github.com/ktonal/peaksjs-widget","bugs":{"url":"https://github.com/ktonal/peaksjs-widget/issues"},"license":"BSD-3-Clause","author":{"name":"AntoineDaurat","email":"ktonalberlin@gmail.com"},"main":"lib/index.js","types":"./lib/index.d.ts","repository":{"type":"git","url":"https://github.com/ktonal/peaksjs-widget"},"scripts":{"build":"yarn run build:lib && yarn run build:nbextension && yarn run build:labextension:dev","build:prod":"yarn run build:lib && yarn run build:nbextension && yarn run build:labextension","build:labextension":"jupyter labextension build .","build:labextension:dev":"jupyter labextension build --development True .","build:lib":"tsc","build:nbextension":"webpack","clean":"yarn run clean:lib && yarn run clean:nbextension && yarn run clean:labextension","clean:lib":"rimraf lib","clean:labextension":"rimraf peaksjs_widget/labextension","clean:nbextension":"rimraf peaksjs_widget/nbextension/static/index.js","lint":"eslint . --ext .ts,.tsx --fix","lint:check":"eslint . --ext .ts,.tsx","prepack":"yarn run build:lib","test":"jest","watch":"npm-run-all -p watch:*","watch:lib":"tsc -w","watch:nbextension":"webpack --watch --mode=development","watch:labextension":"jupyter labextension watch ."},"dependencies":{"@jupyter-widgets/base":"^6","@jupyter-widgets/controls":"^5","underscore":"^1.13.6","konva":"^8.3.10","peaks.js":"^2.0.2","waveform-data":">= 4.3.0 < 5"},"devDependencies":{"@babel/core":"^7.5.0","@babel/preset-env":"^7.5.0","@jupyter-widgets/base-manager":"^1.0.2","@jupyterlab/builder":"^3.0.0","@lumino/application":"^1.6.0","@lumino/widgets":"^1.6.0","@types/jest":"^26.0.0","@types/webpack-env":"^1.13.6","@typescript-eslint/eslint-plugin":"^3.6.0","@typescript-eslint/parser":"^3.6.0","acorn":"^7.2.0","css-loader":"^3.2.0","eslint":"^7.4.0","eslint-config-prettier":"^6.11.0","eslint-plugin-prettier":"^3.1.4","fs-extra":"^7.0.0","identity-obj-proxy":"^3.0.0","jest":"^26.0.0","mkdirp":"^0.5.1","npm-run-all":"^4.1.3","prettier":"^2.0.5","rimraf":"^2.6.2","source-map-loader":"^1.1.3","style-loader":"^1.0.0","ts-jest":"^26.0.0","ts-loader":"^8.0.0","typescript":"~4.1.3","webpack":"^5.61.0","webpack-cli":"^4.0.0"},"jupyterlab":{"extension":"lib/plugin","outputDir":"peaksjs_widget/labextension/","sharedPackages":{"@jupyter-widgets/base":{"bundled":false,"singleton":true}}}}')}}]);