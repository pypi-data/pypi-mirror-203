import{r as u,L as ge,M as be,b as je,H as ve,a as ke,R as K,D as he,I as we,y as Ne,T as Pe,o as ne,s as Ce,p as _e,c as Re,d as Ee,P as Se,e as Ae,f as ue,g as De,j as e,h as V,E as R,u as Q,i as se,k as H,l as Oe,m as C,n as U,q as Be,t as Te,v as r,w as M,x as G,z as Fe,A as Y,B as fe,C as xe,S as ye,F as te,G as Me,J as _,K as Z,N as J,O as ae,Q as le,U as ce,V as pe,W as ee,X as v,Y as ze,Z as Ie,_ as $e,$ as Ue,a0 as Ve,a1 as re,a2 as me,a3 as We,a4 as Le}from"./index-0d5132a3.js";let de=u.createContext(null);de.displayName="GroupContext";let Ge=u.Fragment;function He(s){var n;let[t,d]=u.useState(null),[i,o]=ve(),[c,p]=ke(),k=u.useMemo(()=>({switch:t,setSwitch:d,labelledby:i,describedby:c}),[t,d,i,c]),h={},f=s;return K.createElement(p,{name:"Switch.Description"},K.createElement(o,{name:"Switch.Label",props:{htmlFor:(n=k.switch)==null?void 0:n.id,onClick(g){t&&(g.currentTarget.tagName==="LABEL"&&g.preventDefault(),t.click(),t.focus({preventScroll:!0}))}}},K.createElement(de.Provider,{value:k},he({ourProps:h,theirProps:f,defaultTag:Ge,name:"Switch.Group"}))))}let Qe="button";function qe(s,n){let t=we(),{id:d=`headlessui-switch-${t}`,checked:i,defaultChecked:o=!1,onChange:c,name:p,value:k,...h}=s,f=u.useContext(de),g=u.useRef(null),N=Ne(g,n,f===null?null:f.setSwitch),[b,x]=Pe(i,c,o),a=ne(()=>x==null?void 0:x(!b)),j=ne(y=>{if(Ae(y.currentTarget))return y.preventDefault();y.preventDefault(),a()}),O=ne(y=>{y.key===ue.Space?(y.preventDefault(),a()):y.key===ue.Enter&&De(y.currentTarget)}),B=ne(y=>y.preventDefault()),A=u.useMemo(()=>({checked:b}),[b]),I={id:d,ref:N,role:"switch",type:Ce(s,g),tabIndex:0,"aria-checked":b,"aria-labelledby":f==null?void 0:f.labelledby,"aria-describedby":f==null?void 0:f.describedby,onClick:j,onKeyUp:O,onKeyPress:B},E=_e();return u.useEffect(()=>{var y;let $=(y=g.current)==null?void 0:y.closest("form");$&&o!==void 0&&E.addEventListener($,"reset",()=>{x(o)})},[g,x]),K.createElement(K.Fragment,null,p!=null&&b&&K.createElement(Re,{features:Ee.Hidden,...Se({as:"input",type:"checkbox",hidden:!0,readOnly:!0,checked:b,name:p,value:k})}),he({ourProps:I,theirProps:h,slot:A,defaultTag:Qe,name:"Switch"}))}let Ke=ge(qe),Ye=He,Ze=Object.assign(Ke,{Group:Ye,Label:be,Description:je});function oe({variant:s,headline:n,description:t}){return e.jsx("div",{className:"mt-4 mb-2 flex items-center w-full text-sm",children:e.jsxs("div",{className:V("p-4 w-full h-full border-2 rounded-lg",s===R.Primary&&"bg-primary-10 border-primary-400 text-primary-600",s===R.Secondary&&"bg-secondary-10 border-secondary-400 text-secondary-600",s===R.Success&&"bg-success-10 border-success-400 text-success-600",s===R.Warning&&"bg-warning-10 border-warning-400 text-warning-600",s===R.Danger&&"bg-danger-10 border-danger-400 text-danger-600",s===R.Info&&"bg-neutral-10 border-neutral-400 text-neutral-400"),children:[n!=null&&e.jsx("h4",{className:"mb-2 font-bold text-lg",children:n}),t!=null&&e.jsx("p",{className:"text-prose",children:t})]})})}function Je({setRefTasksOverview:s}){const[n]=Me(),{backfills:t,hasChanges:d,hasBackfills:i,activeBackfill:o,modified:c,added:p,removed:k,virtualUpdateDescription:h,skip_backfill:f,skip_tests:g,change_categorization:N,hasVirtualUpdate:b}=Q(),x=se(m=>m.environment),a=H(m=>m.state),j=H(m=>m.action),[O,B]=u.useState(),A=u.useMemo(()=>Array.from(N.values()).reduce((m,{category:w,change:P})=>{var S;return(S=P==null?void 0:P.indirect)==null||S.forEach(D=>{var F;m[D]==null&&(m[D]=[]),(F=m[D])==null||F.push(w.value!==1)}),w.value===3&&(m[P.model_name]=[!0]),m},{}),[N]),I=u.useCallback(m=>Object.entries(m).reduce((w,[P,S])=>{const D=A[P];return(D!=null?D.every(Boolean):!1)||(w[P]=S),w},{}),[A]),E=u.useCallback(m=>m.reduce((w,P)=>{const S=P.model_name,D=P.interval,F={completed:0,total:P.batches,interval:D,view_name:P.view_name},l=A[S];return(l!=null?l.every(Boolean):!1)||(w[S]=F),w},{}),[A]),y=u.useMemo(()=>(o==null?void 0:o.tasks)!=null?I(o.tasks):E(t),[t,N,o]);u.useEffect(()=>{const m=n("tests",B);return()=>{m==null||m()}},[]);const $=a===_.Finished,T=[d,i,Oe(y)].every(C),W=b&&C($)||C(T)&&i&&C(f)&&U(Object.keys(y)),L=Be({planAction:j,planState:a,hasBackfills:i,hasVirtualUpdate:b,hasNoChanges:T||Te(Object.keys(y)),skip_backfill:f});return e.jsx("ul",{className:"w-full",children:j===r.Run?e.jsx(z.StepOptions,{className:"w-full"}):e.jsxs(e.Fragment,{children:[e.jsx(ie,{headline:"Tests",description:"Report",disabled:x==null,children:j===r.Running?e.jsx(X,{hasSpinner:!0,children:"Running Tests ..."}):O==null?e.jsx(X,{children:g?"Tests Skipped":"No Tests"}):e.jsx(oe,{variant:O.ok?R.Success:R.Danger,description:O.message})}),e.jsx(ie,{headline:"Models",description:"Review Changes",disabled:x==null,children:d?e.jsxs(e.Fragment,{children:[(U(p)||U(k))&&e.jsxs("div",{className:"flex",children:[U(p)&&e.jsx(M,{className:"w-full m-2",headline:"Added Models",type:G.Add,children:e.jsx(M.Default,{type:G.Add,changes:p})}),U(k)&&e.jsx(M,{className:"w-full m-2",headline:"Removed Models",type:G.Remove,children:e.jsx(M.Default,{type:G.Remove,changes:k})})]}),Fe(c)&&e.jsxs(e.Fragment,{children:[U(c==null?void 0:c.direct)&&e.jsx(M,{className:"m-2",headline:"Modified Directly",type:G.Direct,children:e.jsx(M.Direct,{changes:c.direct??[]})}),U(c.indirect)&&e.jsx(M,{className:"m-2",headline:"Modified Indirectly",type:G.Indirect,children:e.jsx(M.Indirect,{changes:c.indirect??[]})}),U(c==null?void 0:c.metadata)&&e.jsx(M,{className:"m-2",headline:"Modified Metadata",type:G.Metadata,children:e.jsx(M.Default,{type:G.Metadata,changes:(c==null?void 0:c.metadata)??[]})})]})]}):j===r.Running?e.jsx(X,{hasSpinner:!0,children:"Checking Models..."}):e.jsx(X,{children:"No Changes"})}),e.jsx(ie,{headline:"Backfill",description:"Progress",disabled:x==null,children:e.jsx(Y,{defaultOpen:i,children:({open:m})=>e.jsxs(e.Fragment,{children:[e.jsx(X,{hasSpinner:C(m)&&(j===r.Running||j===r.Applying),children:e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("h3",{className:V(a===_.Cancelled&&"text-prose",a===_.Failed&&"text-danger-700",a===_.Finished&&"text-success-700"),children:L})}),W&&e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"mr-2 text-sm",children:"Details"}),e.jsx(Y.Button,{className:"flex items-center justify-between rounded-lg text-left text-sm",children:m?e.jsx(fe,{className:"h-6 w-6 text-primary-500"}):e.jsx(xe,{className:"h-6 w-6 text-primary-500"})})]})]})}),e.jsxs(Y.Panel,{className:"px-4 pb-2 text-sm",children:[i&&C(f)&&U(Object.keys(y))&&e.jsx(e.Fragment,{children:e.jsx(u.Suspense,{fallback:e.jsx(ye,{className:"w-4 h-4 mr-2"}),children:e.jsx(te,{tasks:y,setRefTasksOverview:s,children:({total:w,completed:P,models:S})=>e.jsxs(e.Fragment,{children:[e.jsx(te.Summary,{environment:x.name,planState:a,headline:"Target Environment",completed:P,total:w,updateType:b?"Virtual":"Backfill",updatedAt:o==null?void 0:o.updated_at}),S!=null&&e.jsx(te.Details,{models:S,changes:{modified:c,added:p,removed:k},showBatches:i,showVirtualUpdate:b,showProgress:!0})]})})})}),b&&e.jsx("div",{children:e.jsx("small",{className:"text-sm",children:h})})]})]})},L)})]})})}function X({hasSpinner:s=!1,children:n}){return e.jsx("span",{className:"mt-1 mb-4 px-4 py-2 bg-primary-10 flex w-full rounded-lg",children:e.jsxs("span",{className:"flex items-center w-full",children:[s&&e.jsx(ye,{className:"w-4 h-4 mr-2"}),n]})})}function ie({headline:s,description:n,children:t,disabled:d=!1}){return e.jsxs("li",{className:"mb-2 p-4",children:[e.jsx(Xe,{className:"min-w-[25%] pr-12",headline:s,disabled:d,children:n}),!d&&t]})}function Xe({disabled:s=!1,headline:n,children:t,className:d}){return e.jsxs("div",{className:V(s&&"opacity-40 cursor-not-allowed","mb-4 ",d),children:[n!=null&&e.jsx("h3",{className:"whitespace-nowrap font-bold text-lg",children:n}),t!=null&&e.jsx("small",{className:"whitespace-nowrap",children:t})]})}function es({error:s}){const n=se(t=>t.environment);return e.jsxs("div",{className:"w-full py-4 px-6",children:[e.jsxs("h4",{className:"text-xl",children:[e.jsx("span",{className:"font-bold",children:"Target Environment is"}),e.jsx("b",{className:"ml-2 px-2 py-1 font-sm rounded-md bg-primary-10 text-primary-500",children:n.name})]}),n.isInitial&&n.isDefault&&e.jsx(oe,{variant:R.Warning,headline:"Initializing Prod Environment",description:`Prod will be completely backfilled in order to ensure there are no data gaps.
          After this is applied, it is recommended to validate further changes in a dev environment before
          deploying to production.`}),s!=null&&e.jsx(oe,{variant:R.Danger,headline:"Error",description:s.message})]})}function ss(s=0){return u.useCallback(n=>{setTimeout(()=>{n==null||n.focus()},s)},[s])}function ns({planAction:s,disabled:n,run:t,apply:d,cancel:i,close:o,reset:c}){const{start:p,end:k,hasBackfills:h,skip_tests:f,auto_apply:g,skip_backfill:N,no_gaps:b,no_auto_categorization:x,forward_only:a,restate_models:j,hasVirtualUpdate:O}=Q(),B=se(l=>l.environment),A=ss(),I=s===r.Run,E=s===r.Done,y=s===r.Cancelling,$=s===r.Apply,T=s===r.Applying,W=s===r.Running,L=W||T||y;function m(l){l.stopPropagation(),o()}function w(l){l.stopPropagation(),c()}function P(l){l.stopPropagation(),i()}function S(l){l.stopPropagation(),d()}function D(l){l.stopPropagation(),t()}const F=h&&C(N);return e.jsxs("div",{className:"flex justify-between px-4 py-2",children:[e.jsxs("div",{className:"flex w-full items-center",children:[(I||W)&&e.jsxs(Z,{disabled:W||n,onClick:D,autoFocus:!0,ref:A,variant:R.Primary,children:[e.jsx("span",{children:J(s,[r.Running,r.Run])}),f&&e.jsx("span",{className:"inline-block ml-1",children:"And Skip Test"}),g&&e.jsx("span",{className:"inline-block ml-1",children:"And Auto Apply"})]}),($||T)&&e.jsx(Z,{onClick:S,disabled:T||n,ref:A,variant:R.Primary,children:J(s,[r.Applying],F?"Apply And Backfill":O?"Apply Virtual Update":"Apply")}),L&&e.jsx(Z,{onClick:P,variant:R.Danger,className:"justify-self-end",disabled:y||n,children:J(s,[r.Cancelling],"Cancel")}),(I||W||$||T)&&e.jsxs("p",{className:"ml-2 text-xs max-w-sm",children:[e.jsx("span",{children:"Plan for"}),e.jsx("b",{className:"text-primary-500 font-bold mx-1",children:B.name}),e.jsx("span",{className:"inline-block mr-1",children:"environment"}),e.jsxs("span",{className:"inline-block mr-1",children:["from"," ",e.jsx("b",{children:C(le(p))?p:"the begining of history"})]}),e.jsxs("span",{className:"inline-block mr-1",children:["till ",e.jsx("b",{children:C(le(p))?k:"today"})]}),b&&e.jsxs("span",{className:"inline-block mr-1",children:["with ",e.jsx("b",{children:"No Gaps"})]}),N&&e.jsxs("span",{className:"inline-block mr-1",children:["without ",e.jsx("b",{children:"Backfills"})]}),a&&e.jsxs("span",{className:"inline-block mr-1",children:["consider as a ",e.jsx("b",{children:"Breaking Change"})]}),x&&e.jsxs("span",{className:"inline-block mr-1",children:["also set ",e.jsx("b",{children:"Change Category"})," manually"]}),C(le(j))&&e.jsxs("span",{className:"inline-block mr-1",children:["and restate folowing models ",e.jsx("b",{children:j})]})]})]}),e.jsxs("div",{className:"flex items-center",children:[[L,I,n,B.isInitial&&B.isDefault,E].every(C)&&e.jsx(Z,{onClick:w,variant:R.Neutral,disabled:ae([r.Resetting,r.Running,r.Applying,r.Cancelling],s)||n,children:J(s,[r.Resetting],"Start Over")}),e.jsx(Z,{onClick:m,variant:E?R.Primary:R.Neutral,disabled:ae([r.Running,r.Resetting,r.Cancelling],s)||n,ref:E||T?A:void 0,children:J(s,[r.Done],"Close")})]})]})}function ls({enabled:s,setEnabled:n,a11yTitle:t,className:d,disabled:i=!1}){return e.jsxs(Ze,{checked:i?!1:s,onChange:n,className:V("relative inline-flex h-8 w-16 shrink-0 rounded-full border-2 transition-colors duration-200 ease-in-out focus:outline-none focus:ring-4 ring-secondary-300 ring-opacity-60 ring-offset ring-offset-secondary-100 focus:border-secondary-500 focus-visible:ring-opacity-75","border-secondary-30",s?"bg-secondary-500":"bg-secondary-10",d,i?"opacity-50 cursor-not-allowed":"cursor-pointer"),disabled:i,children:[e.jsx("span",{className:"sr-only",children:t}),e.jsx("span",{"aria-hidden":"true",className:V("pointer-events-none inline-block h-6 w-6 transform rounded-full shadow-md  transition duration-200 ease-in-out","bg-light translate-y-[0.125rem]",s?"translate-x-8 shadow-primary-800":"translate-x-1 shadow-neutral-300 dark:shadow-neutral-600")})]})}function q({label:s,info:n,enabled:t,disabled:d=!1,setEnabled:i}){return e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("label",{className:"block mb-1 px-3 text-sm font-bold",children:[s,e.jsx("small",{className:"block text-xs text-neutral-500",children:n})]}),e.jsx(ls,{disabled:d,className:"mt-2",enabled:t,setEnabled:i})]})}function as({className:s}){const n=ce(),{skip_tests:t,no_gaps:d,skip_backfill:i,forward_only:o,auto_apply:c,no_auto_categorization:p,restate_models:k,isInitialPlanRun:h,create_from:f}=Q(),g=se(x=>x.environment),N=se(x=>x.environments),b=pe.getOnlySyncronized(Array.from(N));return e.jsx("li",{className:V("mt-6 mb-6",s),children:e.jsxs("form",{className:"w-full h-full",children:[e.jsxs("fieldset",{className:V("mb-10 mt-6"),children:[e.jsx("h2",{className:"whitespace-nowrap text-xl font-bold mb-1 px-4",children:"Set Dates"}),e.jsx("div",{className:"mt-3",children:e.jsx(z.BackfillDates,{})})]}),e.jsx("fieldset",{className:V("mb-4 mt-6"),children:e.jsx(Y,{children:({open:x})=>e.jsxs(e.Fragment,{children:[e.jsxs(Y.Button,{className:"flex items-center w-full justify-between rounded-lg text-left text-sm px-4 pt-3 pb-2 hover:bg-theme-darker dark:hover:bg-theme-lighter",children:[e.jsx("h2",{className:"whitespace-nowrap text-xl font-bold mb-1",children:"Additional Options"}),x?e.jsx(fe,{className:"h-6 w-6 text-primary-500"}):e.jsx(xe,{className:"h-6 w-6 text-primary-500"})]}),e.jsxs(Y.Panel,{className:"px-4 pb-2 text-sm text-neutral-500",children:[e.jsx("div",{className:"mt-3",children:e.jsxs("div",{className:"flex flex-wrap md:flex-nowrap",children:[C(g.isDefault)&&e.jsxs("div",{className:"inline-block m-1 w-full",children:[e.jsx(ee.Label,{children:"Create From Environment"}),e.jsx("select",{className:V("w-full bg-neutral-100 border-2 rounded-lg py-2 px-3 text-base leading-4",b.length<2&&"opacity-50 cursor-not-allowed","flex w-full text-prose-lighter bg-theme-lighter border-theme-darker dark:border-theme-lighter dark:text-prose-darker rounded-md","border-2 focus:ring-4 focus:outline-none focus:border-secondary-500","ring-secondary-300 ring-opacity-60 ring-offset ring-offset-secondary-100"),onChange:a=>{n({type:v.PlanOptions,create_from:a.target.value})},disabled:b.length<2,value:f,children:pe.getOnlySyncronized(Array.from(N)).map(a=>e.jsx("option",{value:a.name,children:a.name},a.name))}),e.jsx(ee.Info,{children:"The environment to base the plan on rather than local files"})]}),e.jsx(ee,{className:"w-full",label:"Restate Models",info:`Restate data for specified models and models
              downstream from the one specified. For production
              environment, all related model versions will have
              their intervals wiped, but only the current
              versions will be backfilled. For development
              environment, only the current model versions will
              be affected`,placeholder:"project.model1, project.model2",disabled:h,value:k??"",onInput:a=>{a.stopPropagation(),n({type:v.PlanOptions,restate_models:a.target.value})}})]})}),e.jsxs("div",{className:"flex flex-wrap md:flex-nowrap w-full mt-3",children:[e.jsxs("div",{className:"w-full md:mr-2",children:[e.jsx("div",{className:"block my-2",children:e.jsx(q,{label:"Skip Tests",info:`Skip tests prior to generating the plan if they
                  are defined`,enabled:!!t,setEnabled:a=>{n({type:v.PlanOptions,skip_tests:a})}})}),e.jsx("div",{className:"block my-2",children:e.jsx(q,{label:"No Gaps",info:`Ensure that new snapshots have no data gaps when
                  comparing to existing snapshots for matching
                  models in the target environment`,enabled:!!d,disabled:h,setEnabled:a=>{n({type:v.PlanOptions,no_gaps:a})}})}),e.jsx("div",{className:"block my-2",children:e.jsx(q,{label:"Skip Backfill",info:"Skip the backfill step",enabled:!!i,disabled:h,setEnabled:a=>{n({type:v.PlanOptions,skip_backfill:a})}})})]}),e.jsxs("div",{className:"w-full md:ml-2",children:[e.jsx("div",{className:"block my-2",children:e.jsx(q,{label:"Forward Only",info:"Create a plan for forward-only changes",enabled:!!o,disabled:h,setEnabled:a=>{n({type:v.PlanOptions,forward_only:a})}})}),e.jsx("div",{className:"block my-2",children:e.jsx(q,{label:"Auto Apply",info:"Automatically apply the plan after it is generated",enabled:!!c,setEnabled:a=>{n({type:v.PlanOptions,auto_apply:a})}})}),e.jsx("div",{className:"block my-2",children:e.jsx(q,{label:"No Auto Categorization",info:"Set category manually",enabled:!!p,disabled:h,setEnabled:a=>{n({type:v.PlanOptions,no_auto_categorization:a})}})})]})]})]})]})})})]})})}function ts({disabled:s=!1}){const n=ce(),{start:t,end:d,isInitialPlanRun:i}=Q();return e.jsxs("div",{className:"flex w-full flex-wrap md:flex-nowrap",children:[e.jsx(ee,{className:"w-full md:w-[50%]",label:"Start Date (UTC)",info:"The start datetime of the interval",placeholder:"2023-12-13",disabled:s||i,value:t,onInput:o=>{o.stopPropagation(),n({type:v.DateStart,start:o.target.value})}}),e.jsx(ee,{className:"w-full md:w-[50%]",label:"End Date (UTC)",info:"The end datetime of the interval",placeholder:"2022-12-13",value:d,disabled:s||i,onInput:o=>{o.stopPropagation(),n({type:v.DateEnd,end:o.target.value})}})]})}function rs({environment:s,isInitialPlanRun:n}){const{start:t,end:d,skip_tests:i,no_gaps:o,skip_backfill:c,forward_only:p,no_auto_categorization:k,restate_models:h,create_from:f}=Q(),g=u.useMemo(()=>{if(!s.isDefault)return{start:t,end:n&&le(h)?void 0:d}},[s,t,d,n,h]);return{planOptions:u.useMemo(()=>s.isInitial?{skip_tests:!1}:s.isDefault?{skip_tests:i}:{no_gaps:o,skip_backfill:c,forward_only:p,create_from:f,no_auto_categorization:k,skip_tests:i,restate_models:h},[s,o,c,p,f,k,i,h]),planDates:g}}function is({isInitialPlanRun:s}){const{start:n,end:t,skip_tests:d,no_gaps:i,skip_backfill:o,forward_only:c,no_auto_categorization:p,restate_models:k,hasBackfills:h,create_from:f,change_categorization:g}=Q(),N=u.useMemo(()=>{if(!(s||C(h)))return{start:n,end:t}},[h,n,t,s]),b=u.useMemo(()=>Array.from(g.values()).reduce((x,{category:a,change:j})=>(x[j.model_name]=a.value,x),{}),[g]);return{planDates:N,planOptions:{no_gaps:i,skip_backfill:o,forward_only:c,create_from:f,no_auto_categorization:p,skip_tests:d,restate_models:k},categories:b}}function z({environment:s,isInitialPlanRun:n,initialStartDate:t,initialEndDate:d,disabled:i,onClose:o}){const c=ze(),p=ce(),{auto_apply:k,hasChanges:h,hasBackfills:f,hasVirtualUpdate:g}=Q(),N=H(l=>l.state),b=H(l=>l.action),x=H(l=>l.activePlan),a=H(l=>l.setAction),j=H(l=>l.setState),O=u.useRef(null),[B,A]=u.useState(!1),[I,E]=u.useState(),y=rs({environment:s,isInitialPlanRun:n}),$=is({isInitialPlanRun:n}),{refetch:T}=Ie(s.name,y),{refetch:W}=$e(s.name,$),L=u.useCallback(Ue(T,1e3,!0),[T]);u.useEffect(()=>(s.isInitial&&s.isDefault&&F(),p([{type:v.Dates,start:t,end:d}]),()=>{L.cancel(),Ve(c)}),[]),u.useEffect(()=>{p([{type:v.External,isInitialPlanRun:n}]),n&&p([{type:v.PlanOptions,skip_backfill:!1,forward_only:!1,no_auto_categorization:!1,no_gaps:!1}])},[n]),u.useEffect(()=>{C(B)&&s.isInitial||ae([_.Running,_.Applying,_.Cancelling],N)||(C(B)?a(r.Run):C(h||f)&&C(g)||ae([_.Finished,_.Failed],N)?a(r.Done):a(r.Apply))},[N,B,h,f,g]),u.useEffect(()=>{x!=null&&p({type:v.BackfillProgress,activeBackfill:x})},[x]);function m(){A(!1),p([{type:v.ResetBackfills},{type:v.ResetChanges},{type:v.Dates,start:t,end:d},{type:v.ResetPlanOptions}])}function w(){a(r.Resetting),m(),j(_.Init),a(r.Run)}function P(){o()}function S(){E(void 0),j(_.Cancelling),a(r.Cancelling),We(c).then(()=>{a(r.Run),j(_.Cancelled)}).catch(l=>{re(l)?console.log("apiCancelPlanApply","Request aborted by React Query"):(console.log("apiCancelPlanApply",l),E(l),w())})}function D(){E(void 0),a(r.Applying),j(_.Applying),W({throwOnError:!0}).then(({data:l})=>{(l==null?void 0:l.type)===Le.Virtual&&j(_.Finished)}).catch(l=>{re(l)?console.log("planApply","Request aborted by React Query"):(console.log("planApply",l),E(l),w())}).finally(()=>{var l;(l=O==null?void 0:O.current)==null||l.scrollIntoView({behavior:"smooth",block:"start"})})}function F(){E(void 0),a(r.Running),j(_.Running),L({throwOnError:!0}).then(({data:l})=>{p([{type:v.Backfills,backfills:l==null?void 0:l.backfills},{type:v.Changes,...l==null?void 0:l.changes},{type:v.Dates,start:l==null?void 0:l.start,end:l==null?void 0:l.end}]),A(!0),j(_.Init),k?D():a(r.Run)}).catch(l=>{re(l)?console.log("planRun","Request aborted by React Query"):(console.log("planRun",l),E(l),w())})}return e.jsxs("div",{className:"flex flex-col w-full h-full overflow-hidden pt-6",children:[e.jsx(z.Header,{error:I}),e.jsx(me,{}),e.jsx("div",{className:"flex flex-col w-full h-full overflow-hidden overflow-y-auto p-4 scrollbar scrollbar--vertical",children:e.jsx(z.Wizard,{setRefTasksOverview:O})}),e.jsx(me,{}),e.jsx(z.Actions,{disabled:i,planAction:b,apply:D,run:F,cancel:S,close:P,reset:w})]})}z.Actions=ns;z.Header=es;z.Wizard=Je;z.StepOptions=as;z.BackfillDates=ts;export{z as default};
